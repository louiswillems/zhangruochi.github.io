<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang>
<head><meta name="generator" content="Hexo 3.9.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">
<meta name="baidu-site-verification" content="PfeH4jmhwL">
<meta name="google-site-verification" content="A749_BVo91Gbd5oqBRsAAzolnmY_5JCET--CVn3ZQQA">








<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=PingFang SC:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Didot:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Bandits,Exploration,Exploitation">





  <link rel="alternate" href="/atom.xml" title="RUOCHI.AI" type="application/atom+xml">






<meta name="description" content="Assignment 1: Bandits and Exploration/ExploitationWelcome to Assignment 1. This notebook will:  Help you create your first bandit algorithm Help you understand the effect of epsilon on exploration and">
<meta name="keywords" content="Bandits,Exploration,Exploitation">
<meta property="og:type" content="article">
<meta property="og:title" content="Bandits and Exploration&#x2F;Exploitation">
<meta property="og:url" content="https://zhangruochi.com/Bandits-and-Exploration-Exploitation/2020/09/03/index.html">
<meta property="og:site_name" content="RUOCHI.AI">
<meta property="og:description" content="Assignment 1: Bandits and Exploration/ExploitationWelcome to Assignment 1. This notebook will:  Help you create your first bandit algorithm Help you understand the effect of epsilon on exploration and">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://zhangruochi.com/Bandits-and-Exploration-Exploitation/2020/09/03/output_15_1.png">
<meta property="og:image" content="https://zhangruochi.com/Bandits-and-Exploration-Exploitation/2020/09/03/output_23_1.png">
<meta property="og:image" content="https://zhangruochi.com/Bandits-and-Exploration-Exploitation/2020/09/03/output_27_0.png">
<meta property="og:image" content="https://zhangruochi.com/Bandits-and-Exploration-Exploitation/2020/09/03/output_33_1.png">
<meta property="og:image" content="https://zhangruochi.com/Bandits-and-Exploration-Exploitation/2020/09/03/output_40_1.png">
<meta property="og:image" content="https://zhangruochi.com/Bandits-and-Exploration-Exploitation/2020/09/03/output_42_0.png">
<meta property="og:image" content="https://zhangruochi.com/Bandits-and-Exploration-Exploitation/2020/09/03/output_42_1.png">
<meta property="og:image" content="https://zhangruochi.com/Bandits-and-Exploration-Exploitation/2020/09/03/output_42_2.png">
<meta property="og:image" content="https://zhangruochi.com/Bandits-and-Exploration-Exploitation/2020/09/03/output_42_3.png">
<meta property="og:image" content="https://zhangruochi.com/Bandits-and-Exploration-Exploitation/2020/09/03/output_42_4.png">
<meta property="og:image" content="https://zhangruochi.com/Bandits-and-Exploration-Exploitation/2020/09/03/output_44_1.png">
<meta property="og:updated_time" content="2020-09-03T10:00:48.172Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Bandits and Exploration&#x2F;Exploitation">
<meta name="twitter:description" content="Assignment 1: Bandits and Exploration/ExploitationWelcome to Assignment 1. This notebook will:  Help you create your first bandit algorithm Help you understand the effect of epsilon on exploration and">
<meta name="twitter:image" content="https://zhangruochi.com/Bandits-and-Exploration-Exploitation/2020/09/03/output_15_1.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"hide","offset":12,"b2t":false,"scrollpercent":false,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://zhangruochi.com/Bandits-and-Exploration-Exploitation/2020/09/03/">





  <title>Bandits and Exploration/Exploitation | RUOCHI.AI</title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="site-title">RUOCHI.AI</span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-projects">
          <a href="/projects/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br>
            
            projects
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://zhangruochi.com/Bandits-and-Exploration-Exploitation/2020/09/03/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ruochi Zhang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RUOCHI.AI">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">Bandits and Exploration/Exploitation</h2>
        

        <div class="post-meta">
          
          

          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-09-03T17:59:35+08:00">
                2020-09-03
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Artificial-Intelligence/" itemprop="url" rel="index">
                    <span itemprop="name">Artificial Intelligence</span>
                  </a>
                </span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Artificial-Intelligence/Reinforcement-Learning/" itemprop="url" rel="index">
                    <span itemprop="name">Reinforcement Learning</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/Bandits-and-Exploration-Exploitation/2020/09/03/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/Bandits-and-Exploration-Exploitation/2020/09/03/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Assignment-1-Bandits-and-Exploration-Exploitation"><a href="#Assignment-1-Bandits-and-Exploration-Exploitation" class="headerlink" title="Assignment 1: Bandits and Exploration/Exploitation"></a>Assignment 1: Bandits and Exploration/Exploitation</h1><p>Welcome to Assignment 1. This notebook will:</p>
<ul>
<li>Help you create your first bandit algorithm</li>
<li>Help you understand the effect of epsilon on exploration and learn about the exploration/exploitation tradeoff</li>
<li>Introduce you to some of the reinforcement learning software we are going to use for this specialization</li>
</ul>
<p>This class uses RL-Glue to implement most of our experiments. It was originally designed by Adam White, Brian Tanner, and Rich Sutton. This library will give you a solid framework to understand how reinforcement learning experiments work and how to run your own. If it feels a little confusing at first, don’t worry - we are going to walk you through it slowly and introduce you to more and more parts as you progress through the specialization.</p>
<p>We are assuming that you have used a Jupyter notebook before. But if not, it is quite simple. Simply press the run button, or shift+enter to run each of the cells. The places in the code that you need to fill in will be clearly marked for you.</p>
<h2 id="Section-0-Preliminaries"><a href="#Section-0-Preliminaries" class="headerlink" title="Section 0: Preliminaries"></a>Section 0: Preliminaries</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Import necessary libraries</span></span><br><span class="line">%matplotlib inline</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> rlglue.rl_glue <span class="keyword">import</span> RLGlue</span><br><span class="line"><span class="keyword">import</span> main_agent</span><br><span class="line"><span class="keyword">import</span> ten_arm_env</span><br><span class="line"><span class="keyword">import</span> test_env</span><br></pre></td></tr></table></figure>
<p>In the above cell, we import the libraries we need for this assignment. We use numpy throughout the course and occasionally provide hints for which methods to use in numpy. Other than that we mostly use vanilla python and the occasional other library, such as matplotlib for making plots.</p>
<p>You might have noticed that we import ten_arm_env. This is the <strong>10-armed Testbed</strong> introduced in <a href="http://www.incompleteideas.net/book/RLbook2018.pdf" target="_blank" rel="noopener">section 2.3</a> of the textbook. We use this throughout this notebook to test our bandit agents. It has 10 arms, which are the actions the agent can take. Pulling an arm generates a stochastic reward from a Gaussian distribution with unit-variance. For each action, the expected value of that action is randomly sampled from a normal distribution, at the start of each run. If you are unfamiliar with the 10-armed Testbed please review it in the textbook before continuing.</p>
<p><strong>DO NOT IMPORT OTHER LIBRARIES as this will break the autograder.</strong></p>
<p><strong>DO NOT SET A RANDOM SEED as this will break the autograder.</strong></p>
<h2 id="Section-1-Greedy-Agent"><a href="#Section-1-Greedy-Agent" class="headerlink" title="Section 1: Greedy Agent"></a>Section 1: Greedy Agent</h2><p>We want to create an agent that will find the action with the highest expected reward. One way an agent could operate is to always choose the action with  the highest value based on the agent’s current estimates. This is called a greedy agent as it greedily chooses the action that it thinks has the highest value. Let’s look at what happens in this case.</p>
<p>First we are going to implement the argmax function, which takes in a list of action values and returns an action with the highest value. Why are we implementing our own instead of using the argmax function that numpy uses? Numpy’s argmax function returns the first instance of the highest value. We do not want that to happen as it biases the agent to choose a specific action in the case of ties. Instead we want to break ties between the highest values randomly. So we are going to implement our own argmax function. You may want to look at <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.random.choice.html" target="_blank" rel="noopener">np.random.choice</a> to randomly select from a list of values.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -----------</span></span><br><span class="line"><span class="comment"># Graded Cell</span></span><br><span class="line"><span class="comment"># -----------</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">argmax</span><span class="params">(q_values)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Takes in a list of q_values and returns the index of the item </span></span><br><span class="line"><span class="string">    with the highest value. Breaks ties randomly.</span></span><br><span class="line"><span class="string">    returns: int - the index of the highest value in q_values</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    top_value = float(<span class="string">"-inf"</span>)</span><br><span class="line">    ties = []</span><br><span class="line">    </span><br><span class="line">    top_value = max(q_values)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(q_values)):</span><br><span class="line">        <span class="comment"># if a value in q_values is greater than the highest value update top and reset ties to zero</span></span><br><span class="line">        <span class="comment"># if a value is equal to top value add the index to ties</span></span><br><span class="line">        <span class="comment"># return a random selection from ties.</span></span><br><span class="line">        <span class="comment"># YOUR CODE HERE</span></span><br><span class="line">        <span class="keyword">if</span> q_values[i] == top_value:</span><br><span class="line">            ties.append(i)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> np.random.choice(ties)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># --------------</span></span><br><span class="line"><span class="comment"># Debugging Cell</span></span><br><span class="line"><span class="comment"># --------------</span></span><br><span class="line"><span class="comment"># Feel free to make any changes to this cell to debug your code</span></span><br><span class="line"></span><br><span class="line">test_array = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>]</span><br><span class="line"><span class="keyword">assert</span> argmax(test_array) == <span class="number">8</span>, <span class="string">"Check your argmax implementation returns the index of the largest value"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># make sure np.random.choice is called correctly</span></span><br><span class="line">np.random.seed(<span class="number">0</span>)</span><br><span class="line">test_array = [<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> argmax(test_array) == <span class="number">0</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -----------</span></span><br><span class="line"><span class="comment"># Tested Cell</span></span><br><span class="line"><span class="comment"># -----------</span></span><br><span class="line"><span class="comment"># The contents of the cell will be tested by the autograder.</span></span><br><span class="line"><span class="comment"># If they do not pass here, they will not pass there.</span></span><br><span class="line"></span><br><span class="line">test_array = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>]</span><br><span class="line"><span class="keyword">assert</span> argmax(test_array) == <span class="number">8</span>, <span class="string">"Check your argmax implementation returns the index of the largest value"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># set random seed so results are deterministic</span></span><br><span class="line">np.random.seed(<span class="number">0</span>)</span><br><span class="line">test_array = [<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">counts = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">100</span>):</span><br><span class="line">    a = argmax(test_array)</span><br><span class="line">    counts[a] += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># make sure argmax does not always choose first entry</span></span><br><span class="line"><span class="keyword">assert</span> counts[<span class="number">0</span>] != <span class="number">100</span>, <span class="string">"Make sure your argmax implementation randomly choooses among the largest values."</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># make sure argmax does not always choose last entry</span></span><br><span class="line"><span class="keyword">assert</span> counts[<span class="number">3</span>] != <span class="number">100</span>, <span class="string">"Make sure your argmax implementation randomly choooses among the largest values."</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># make sure the random number generator is called exactly once whenver `argmax` is called</span></span><br><span class="line">expected = [<span class="number">44</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">56</span>] <span class="comment"># &lt;-- notice not perfectly uniform due to randomness</span></span><br><span class="line"><span class="keyword">assert</span> counts == expected</span><br></pre></td></tr></table></figure>
<p>Now we introduce the first part of an RL-Glue agent that you will implement. Here we are going to create a GreedyAgent and implement the agent_step method. This method gets called each time the agent takes a step. The method has to return the action selected by the agent. This method also ensures the agent’s estimates are updated based on the signals it gets from the environment.</p>
<p>Fill in the code below to implement a greedy agent.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -----------</span></span><br><span class="line"><span class="comment"># Graded Cell</span></span><br><span class="line"><span class="comment"># -----------</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GreedyAgent</span><span class="params">(main_agent.Agent)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">agent_step</span><span class="params">(self, reward, observation)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Takes one step for the agent. It takes in a reward and observation and </span></span><br><span class="line"><span class="string">        returns the action the agent chooses at that time step.</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        Arguments:</span></span><br><span class="line"><span class="string">        reward -- float, the reward the agent recieved from the environment after taking the last action.</span></span><br><span class="line"><span class="string">        observation -- float, the observed state the agent is in. Do not worry about this as you will not use it</span></span><br><span class="line"><span class="string">                              until future lessons</span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">        current_action -- int, the action chosen by the agent at the current time step.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="comment">### Useful Class Variables ###</span></span><br><span class="line">        <span class="comment"># self.q_values : An array with what the agent believes each of the values of the arm are.</span></span><br><span class="line">        <span class="comment"># self.arm_count : An array with a count of the number of times each arm has been pulled.</span></span><br><span class="line">        <span class="comment"># self.last_action : The action that the agent took on the previous time step</span></span><br><span class="line">        <span class="comment">#######################</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Update Q values Hint: Look at the algorithm in section 2.4 of the textbook.</span></span><br><span class="line">        <span class="comment"># increment the counter in self.arm_count for the action from the previous time step</span></span><br><span class="line">        <span class="comment"># update the step size using self.arm_count</span></span><br><span class="line">        <span class="comment"># update self.q_values for the action from the previous time step</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># YOUR CODE HERE</span></span><br><span class="line">        </span><br><span class="line">        self.arm_count[self.last_action] += <span class="number">1</span></span><br><span class="line">        self.q_values[self.last_action] = self.q_values[self.last_action] + (<span class="number">1.0</span> / self.arm_count[self.last_action]) * (reward - self.q_values[self.last_action])</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment"># current action = ? # Use the argmax function you created above</span></span><br><span class="line">        <span class="comment"># YOUR CODE HERE</span></span><br><span class="line">        current_action = argmax(self.q_values)</span><br><span class="line">        self.last_action = current_action</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> current_action</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># --------------</span></span><br><span class="line"><span class="comment"># Debugging Cell</span></span><br><span class="line"><span class="comment"># --------------</span></span><br><span class="line"><span class="comment"># Feel free to make any changes to this cell to debug your code</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># build a fake agent for testing and set some initial conditions</span></span><br><span class="line">np.random.seed(<span class="number">1</span>)</span><br><span class="line">greedy_agent = GreedyAgent()</span><br><span class="line">greedy_agent.q_values = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0.5</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">greedy_agent.arm_count = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">greedy_agent.last_action = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">action = greedy_agent.agent_step(reward=<span class="number">1</span>, observation=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># make sure the q_values were updated correctly</span></span><br><span class="line"><span class="keyword">assert</span> greedy_agent.q_values == [<span class="number">0</span>, <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># make sure the agent is using the argmax that breaks ties randomly</span></span><br><span class="line"><span class="keyword">assert</span> action == <span class="number">2</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lock</span></span><br><span class="line"><span class="comment"># -----------</span></span><br><span class="line"><span class="comment"># Tested Cell</span></span><br><span class="line"><span class="comment"># -----------</span></span><br><span class="line"><span class="comment"># The contents of the cell will be tested by the autograder.</span></span><br><span class="line"><span class="comment"># If they do not pass here, they will not pass there.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># build a fake agent for testing and set some initial conditions</span></span><br><span class="line">greedy_agent = GreedyAgent()</span><br><span class="line">greedy_agent.q_values = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">1.0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">greedy_agent.arm_count = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">greedy_agent.last_action = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># take a fake agent step</span></span><br><span class="line">action = greedy_agent.agent_step(reward=<span class="number">1</span>, observation=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># make sure agent took greedy action</span></span><br><span class="line"><span class="keyword">assert</span> action == <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># make sure q_values were updated correctly</span></span><br><span class="line"><span class="keyword">assert</span> greedy_agent.q_values == [<span class="number">0</span>, <span class="number">0.5</span>, <span class="number">1.0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<p>Let’s visualize the result. Here we run an experiment using RL-Glue to test our agent. For now, we will set up the experiment code; in future lessons, we will walk you through running experiments so that you can create your own.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ---------------</span></span><br><span class="line"><span class="comment"># Discussion Cell</span></span><br><span class="line"><span class="comment"># ---------------</span></span><br><span class="line"></span><br><span class="line">num_runs = <span class="number">200</span>                    <span class="comment"># The number of times we run the experiment</span></span><br><span class="line">num_steps = <span class="number">1000</span>                  <span class="comment"># The number of pulls of each arm the agent takes</span></span><br><span class="line">env = ten_arm_env.Environment     <span class="comment"># We set what environment we want to use to test</span></span><br><span class="line">agent = GreedyAgent               <span class="comment"># We choose what agent we want to use</span></span><br><span class="line">agent_info = &#123;<span class="string">"num_actions"</span>: <span class="number">10</span>&#125;  <span class="comment"># We pass the agent the information it needs. Here how many arms there are.</span></span><br><span class="line">env_info = &#123;&#125;                     <span class="comment"># We pass the environment the information it needs. In this case nothing.</span></span><br><span class="line"></span><br><span class="line">all_averages = []</span><br><span class="line"></span><br><span class="line">average_best = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> run <span class="keyword">in</span> tqdm(range(num_runs)):           <span class="comment"># tqdm is what creates the progress bar below</span></span><br><span class="line">    np.random.seed(run)</span><br><span class="line">    </span><br><span class="line">    rl_glue = RLGlue(env, agent)          <span class="comment"># Creates a new RLGlue experiment with the env and agent we chose above</span></span><br><span class="line">    rl_glue.rl_init(agent_info, env_info) <span class="comment"># We pass RLGlue what it needs to initialize the agent and environment</span></span><br><span class="line">    rl_glue.rl_start()                    <span class="comment"># We start the experiment</span></span><br><span class="line"></span><br><span class="line">    average_best += np.max(rl_glue.environment.arms)</span><br><span class="line">    </span><br><span class="line">    scores = [<span class="number">0</span>]</span><br><span class="line">    averages = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(num_steps):</span><br><span class="line">        reward, _, action, _ = rl_glue.rl_step() <span class="comment"># The environment and agent take a step and return</span></span><br><span class="line">                                                 <span class="comment"># the reward, and action taken.</span></span><br><span class="line">        scores.append(scores[<span class="number">-1</span>] + reward)</span><br><span class="line">        averages.append(scores[<span class="number">-1</span>] / (i + <span class="number">1</span>))</span><br><span class="line">    all_averages.append(averages)</span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">15</span>, <span class="number">5</span>), dpi= <span class="number">80</span>, facecolor=<span class="string">'w'</span>, edgecolor=<span class="string">'k'</span>)</span><br><span class="line">plt.plot([average_best / num_runs <span class="keyword">for</span> _ <span class="keyword">in</span> range(num_steps)], linestyle=<span class="string">"--"</span>)</span><br><span class="line">plt.plot(np.mean(all_averages, axis=<span class="number">0</span>))</span><br><span class="line">plt.legend([<span class="string">"Best Possible"</span>, <span class="string">"Greedy"</span>])</span><br><span class="line">plt.title(<span class="string">"Average Reward of Greedy Agent"</span>)</span><br><span class="line">plt.xlabel(<span class="string">"Steps"</span>)</span><br><span class="line">plt.ylabel(<span class="string">"Average reward"</span>)</span><br><span class="line">plt.show()</span><br><span class="line">greedy_scores = np.mean(all_averages, axis=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<pre><code>100%|██████████| 200/200 [00:03&lt;00:00, 63.68it/s]
</code></pre><p><img src="output_15_1.png" alt="png"></p>
<p>How did our agent do? Is it possible for it to do better?</p>
<h2 id="Section-2-Epsilon-Greedy-Agent"><a href="#Section-2-Epsilon-Greedy-Agent" class="headerlink" title="Section 2: Epsilon-Greedy Agent"></a>Section 2: Epsilon-Greedy Agent</h2><p>We learned about <a href="https://www.coursera.org/learn/fundamentals-of-reinforcement-learning/lecture/tHDck/what-is-the-trade-off" target="_blank" rel="noopener">another way for an agent to operate</a>, where it does not always take the greedy action. Instead, sometimes it takes an exploratory action. It does this so that it can find out what the best action really is. If we always choose what we think is the current best action is, we may miss out on taking the true best action, because we haven’t explored enough times to find that best action.</p>
<p>Implement an epsilon-greedy agent below. Hint: we are implementing the algorithm from <a href="http://www.incompleteideas.net/book/RLbook2018.pdf#page=52" target="_blank" rel="noopener">section 2.4</a> of the textbook. You may want to use your greedy code from above and look at <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.random.random.html" target="_blank" rel="noopener">np.random.random</a>, as well as <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.random.randint.html" target="_blank" rel="noopener">np.random.randint</a>, to help you select random actions. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -----------</span></span><br><span class="line"><span class="comment"># Graded Cell</span></span><br><span class="line"><span class="comment"># -----------</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EpsilonGreedyAgent</span><span class="params">(main_agent.Agent)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">agent_step</span><span class="params">(self, reward, observation)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Takes one step for the agent. It takes in a reward and observation and </span></span><br><span class="line"><span class="string">        returns the action the agent chooses at that time step.</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        Arguments:</span></span><br><span class="line"><span class="string">        reward -- float, the reward the agent recieved from the environment after taking the last action.</span></span><br><span class="line"><span class="string">        observation -- float, the observed state the agent is in. Do not worry about this as you will not use it</span></span><br><span class="line"><span class="string">                              until future lessons</span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">        current_action -- int, the action chosen by the agent at the current time step.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">### Useful Class Variables ###</span></span><br><span class="line">        <span class="comment"># self.q_values : An array with what the agent believes each of the values of the arm are.</span></span><br><span class="line">        <span class="comment"># self.arm_count : An array with a count of the number of times each arm has been pulled.</span></span><br><span class="line">        <span class="comment"># self.last_action : The action that the agent took on the previous time step</span></span><br><span class="line">        <span class="comment"># self.epsilon : The probability an epsilon greedy agent will explore (ranges between 0 and 1)</span></span><br><span class="line">        <span class="comment">#######################</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Update Q values - this should be the same update as your greedy agent above</span></span><br><span class="line">        <span class="comment"># YOUR CODE HERE</span></span><br><span class="line"><span class="comment">#         raise NotImplementedError()</span></span><br><span class="line">        self.arm_count[self.last_action] += <span class="number">1</span></span><br><span class="line">        self.q_values[self.last_action] = self.q_values[self.last_action] + (<span class="number">1.0</span> / self.arm_count[self.last_action]) * (reward - self.q_values[self.last_action])</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Choose action using epsilon greedy</span></span><br><span class="line">        <span class="comment"># Randomly choose a number between 0 and 1 and see if it's less than self.epsilon</span></span><br><span class="line">        <span class="comment"># (hint: look at np.random.random()). If it is, set current_action to a random action.</span></span><br><span class="line">        <span class="comment"># otherwise choose current_action greedily as you did above.</span></span><br><span class="line">        <span class="comment"># YOUR CODE HERE</span></span><br><span class="line"><span class="comment">#         raise NotImplementedError()</span></span><br><span class="line"></span><br><span class="line">        _ = np.random.random()</span><br><span class="line">        </span><br><span class="line">        current_action = argmax(self.q_values) <span class="keyword">if</span> _ &gt;= self.epsilon <span class="keyword">else</span> np.random.randint(<span class="number">0</span>,len(self.q_values))</span><br><span class="line">        </span><br><span class="line">        self.last_action = current_action</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> current_action</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># --------------</span></span><br><span class="line"><span class="comment"># Debugging Cell</span></span><br><span class="line"><span class="comment"># --------------</span></span><br><span class="line"><span class="comment"># Feel free to make any changes to this cell to debug your code</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># build a fake agent for testing and set some initial conditions</span></span><br><span class="line">np.random.seed(<span class="number">0</span>)</span><br><span class="line">e_greedy_agent = EpsilonGreedyAgent()</span><br><span class="line">e_greedy_agent.q_values = [<span class="number">0</span>, <span class="number">0.0</span>, <span class="number">0.5</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">e_greedy_agent.arm_count = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">e_greedy_agent.num_actions = <span class="number">5</span></span><br><span class="line">e_greedy_agent.last_action = <span class="number">1</span></span><br><span class="line">e_greedy_agent.epsilon = <span class="number">0.5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># given this random seed, we should see a greedy action (action 2) here</span></span><br><span class="line">action = e_greedy_agent.agent_step(reward=<span class="number">1</span>, observation=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># -----------------------------------------------</span></span><br><span class="line"><span class="comment"># we'll try to guess a few of the trickier places</span></span><br><span class="line"><span class="comment"># -----------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># make sure to update for the *last_action* not the current action</span></span><br><span class="line"><span class="keyword">assert</span> e_greedy_agent.q_values != [<span class="number">0</span>, <span class="number">0.5</span>, <span class="number">1.0</span>, <span class="number">0</span>, <span class="number">0</span>], <span class="string">"A"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># make sure the stepsize is based on the *last_action* not the current action</span></span><br><span class="line"><span class="keyword">assert</span> e_greedy_agent.q_values != [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0.5</span>, <span class="number">0</span>, <span class="number">0</span>], <span class="string">"B"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># make sure the agent is using the argmax that breaks ties randomly</span></span><br><span class="line"><span class="keyword">assert</span> action == <span class="number">2</span>, <span class="string">"C"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -----------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># let's see what happens for another action</span></span><br><span class="line">np.random.seed(<span class="number">1</span>)</span><br><span class="line">e_greedy_agent = EpsilonGreedyAgent()</span><br><span class="line">e_greedy_agent.q_values = [<span class="number">0</span>, <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">e_greedy_agent.arm_count = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">e_greedy_agent.num_actions = <span class="number">5</span></span><br><span class="line">e_greedy_agent.last_action = <span class="number">1</span></span><br><span class="line">e_greedy_agent.epsilon = <span class="number">0.5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># given this random seed, we should see a random action (action 4) here</span></span><br><span class="line">action = e_greedy_agent.agent_step(reward=<span class="number">1</span>, observation=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># The agent saw a reward of 1, so should increase the value for *last_action*</span></span><br><span class="line"><span class="keyword">assert</span> e_greedy_agent.q_values == [<span class="number">0</span>, <span class="number">0.75</span>, <span class="number">0.5</span>, <span class="number">0</span>, <span class="number">0</span>], <span class="string">"D"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># the agent should have picked a random action for this particular random seed</span></span><br><span class="line"><span class="keyword">assert</span> action == <span class="number">4</span>, <span class="string">"E"</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -----------</span></span><br><span class="line"><span class="comment"># Tested Cell</span></span><br><span class="line"><span class="comment"># -----------</span></span><br><span class="line"><span class="comment"># The contents of the cell will be tested by the autograder.</span></span><br><span class="line"><span class="comment"># If they do not pass here, they will not pass there.</span></span><br><span class="line"></span><br><span class="line">np.random.seed(<span class="number">0</span>)</span><br><span class="line">e_greedy_agent = EpsilonGreedyAgent()</span><br><span class="line">e_greedy_agent.q_values = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">1.0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">e_greedy_agent.arm_count = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">e_greedy_agent.num_actions = <span class="number">5</span></span><br><span class="line">e_greedy_agent.last_action = <span class="number">1</span></span><br><span class="line">e_greedy_agent.epsilon = <span class="number">0.5</span></span><br><span class="line">action = e_greedy_agent.agent_step(reward=<span class="number">1</span>, observation=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> e_greedy_agent.q_values == [<span class="number">0</span>, <span class="number">0.5</span>, <span class="number">1.0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># manipulate the random seed so the agent takes a random action</span></span><br><span class="line">np.random.seed(<span class="number">1</span>)</span><br><span class="line">action = e_greedy_agent.agent_step(reward=<span class="number">0</span>, observation=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> action == <span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># check to make sure we update value for action 4</span></span><br><span class="line">action = e_greedy_agent.agent_step(reward=<span class="number">1</span>, observation=<span class="number">0</span>)</span><br><span class="line"><span class="keyword">assert</span> e_greedy_agent.q_values == [<span class="number">0</span>, <span class="number">0.5</span>, <span class="number">0.0</span>, <span class="number">0</span>, <span class="number">1.0</span>]</span><br></pre></td></tr></table></figure>
<p>Now that we have our epsilon greedy agent created. Let’s compare it against the greedy agent with epsilon of 0.1.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ---------------</span></span><br><span class="line"><span class="comment"># Discussion Cell</span></span><br><span class="line"><span class="comment"># ---------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Plot Epsilon greedy results and greedy results</span></span><br><span class="line">num_runs = <span class="number">200</span></span><br><span class="line">num_steps = <span class="number">1000</span></span><br><span class="line">epsilon = <span class="number">0.1</span></span><br><span class="line">agent = EpsilonGreedyAgent</span><br><span class="line">env = ten_arm_env.Environment</span><br><span class="line">agent_info = &#123;<span class="string">"num_actions"</span>: <span class="number">10</span>, <span class="string">"epsilon"</span>: epsilon&#125;</span><br><span class="line">env_info = &#123;&#125;</span><br><span class="line">all_averages = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> run <span class="keyword">in</span> tqdm(range(num_runs)):</span><br><span class="line">    np.random.seed(run)</span><br><span class="line">    </span><br><span class="line">    rl_glue = RLGlue(env, agent)</span><br><span class="line">    rl_glue.rl_init(agent_info, env_info)</span><br><span class="line">    rl_glue.rl_start()</span><br><span class="line"></span><br><span class="line">    scores = [<span class="number">0</span>]</span><br><span class="line">    averages = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(num_steps):</span><br><span class="line">        reward, _, action, _ = rl_glue.rl_step() <span class="comment"># The environment and agent take a step and return</span></span><br><span class="line">                                                 <span class="comment"># the reward, and action taken.</span></span><br><span class="line">        scores.append(scores[<span class="number">-1</span>] + reward)</span><br><span class="line">        averages.append(scores[<span class="number">-1</span>] / (i + <span class="number">1</span>))</span><br><span class="line">    all_averages.append(averages)</span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">15</span>, <span class="number">5</span>), dpi= <span class="number">80</span>, facecolor=<span class="string">'w'</span>, edgecolor=<span class="string">'k'</span>)</span><br><span class="line">plt.plot([<span class="number">1.55</span> <span class="keyword">for</span> _ <span class="keyword">in</span> range(num_steps)], linestyle=<span class="string">"--"</span>)</span><br><span class="line">plt.plot(greedy_scores)</span><br><span class="line">plt.title(<span class="string">"Average Reward of Greedy Agent vs. E-Greedy Agent"</span>)</span><br><span class="line">plt.plot(np.mean(all_averages, axis=<span class="number">0</span>))</span><br><span class="line">plt.legend((<span class="string">"Best Possible"</span>, <span class="string">"Greedy"</span>, <span class="string">"Epsilon: 0.1"</span>))</span><br><span class="line">plt.xlabel(<span class="string">"Steps"</span>)</span><br><span class="line">plt.ylabel(<span class="string">"Average reward"</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<pre><code>100%|██████████| 200/200 [00:03&lt;00:00, 62.89it/s]
</code></pre><p><img src="output_23_1.png" alt="png"></p>
<p>Notice how much better the epsilon-greedy agent did. Because we occasionally choose a random action we were able to find a better long term policy. By acting greedily before our value estimates are accurate, we risk settling on a suboptimal action.</p>
<h2 id="Section-2-1-Averaging-Multiple-Runs"><a href="#Section-2-1-Averaging-Multiple-Runs" class="headerlink" title="Section 2.1 Averaging Multiple Runs"></a>Section 2.1 Averaging Multiple Runs</h2><p>Did you notice that we averaged over 2000 runs? Why did we do that?</p>
<p>To get some insight, let’s look at the results of two individual runs by the same agent.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ---------------</span></span><br><span class="line"><span class="comment"># Discussion Cell</span></span><br><span class="line"><span class="comment"># ---------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Plot runs of e-greedy agent</span></span><br><span class="line">agent = EpsilonGreedyAgent</span><br><span class="line">env = ten_arm_env.Environment</span><br><span class="line">agent_info = &#123;<span class="string">"num_actions"</span>: <span class="number">10</span>, <span class="string">"epsilon"</span>: <span class="number">0.1</span>&#125;</span><br><span class="line">env_info = &#123;&#125;</span><br><span class="line">all_averages = []</span><br><span class="line">plt.figure(figsize=(<span class="number">15</span>, <span class="number">5</span>), dpi= <span class="number">80</span>, facecolor=<span class="string">'w'</span>, edgecolor=<span class="string">'k'</span>)</span><br><span class="line">num_steps = <span class="number">1000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> run <span class="keyword">in</span> (<span class="number">0</span>, <span class="number">1</span>):</span><br><span class="line">    np.random.seed(run) <span class="comment"># Here we set the seed so that we can compare two different runs</span></span><br><span class="line">    averages = []</span><br><span class="line">    rl_glue = RLGlue(env, agent)</span><br><span class="line">    rl_glue.rl_init(agent_info, env_info)</span><br><span class="line">    rl_glue.rl_start()</span><br><span class="line"></span><br><span class="line">    scores = [<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(num_steps):</span><br><span class="line">        reward, state, action, is_terminal = rl_glue.rl_step()</span><br><span class="line">        scores.append(scores[<span class="number">-1</span>] + reward)</span><br><span class="line">        averages.append(scores[<span class="number">-1</span>] / (i + <span class="number">1</span>))</span><br><span class="line">    </span><br><span class="line">    plt.plot(averages)</span><br><span class="line"></span><br><span class="line">plt.title(<span class="string">"Comparing two independent runs"</span>)</span><br><span class="line">plt.xlabel(<span class="string">"Steps"</span>)</span><br><span class="line">plt.ylabel(<span class="string">"Average reward"</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="output_27_0.png" alt="png"></p>
<p>Notice how the two runs were different? But, if this is the exact same algorithm, why does it behave differently in these two runs?</p>
<p>The answer is that it is due to randomness in the environment and in the agent. Depending on what action the agent randomly starts with, or when it randomly chooses to explore, it can change the results of the runs. And even if the agent chooses the same action, the reward from the environment is randomly sampled from a Gaussian. The agent could get lucky, and see larger rewards for the best action early on and so settle on the best action faster. Or, it could get unlucky and see smaller rewards for best action early on and so take longer to recognize that it is in fact the best action.</p>
<p>To be more concrete, let’s look at how many times an exploratory action is taken, for different seeds. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ---------------</span></span><br><span class="line"><span class="comment"># Discussion Cell</span></span><br><span class="line"><span class="comment"># ---------------</span></span><br><span class="line">print(<span class="string">"Random Seed 1"</span>)</span><br><span class="line">np.random.seed(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">15</span>):</span><br><span class="line">    <span class="keyword">if</span> np.random.random() &lt; <span class="number">0.1</span>:</span><br><span class="line">        print(<span class="string">"Exploratory Action"</span>)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">print()</span><br><span class="line">print()</span><br><span class="line"></span><br><span class="line">print(<span class="string">"Random Seed 2"</span>)</span><br><span class="line">np.random.seed(<span class="number">2</span>)</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">15</span>):</span><br><span class="line">    <span class="keyword">if</span> np.random.random() &lt; <span class="number">0.1</span>:</span><br><span class="line">        print(<span class="string">"Exploratory Action"</span>)</span><br></pre></td></tr></table></figure>
<pre><code>Random Seed 1
Exploratory Action
Exploratory Action
Exploratory Action


Random Seed 2
Exploratory Action
</code></pre><p>With the first seed, we take an exploratory action three times out of 15, but with the second, we only take an exploratory action once. This can significantly affect the performance of our agent because the amount of exploration has changed significantly.</p>
<p>To compare algorithms, we therefore report performance averaged across many runs. We do this to ensure that we are not simply reporting a result that is due to stochasticity, as explained <a href="https://www.coursera.org/learn/fundamentals-of-reinforcement-learning/lecture/PtVBs/sequential-decision-making-with-evaluative-feedback" target="_blank" rel="noopener">in the lectures</a>. Rather, we want statistically significant outcomes. We will not use statistical significance tests in this course. Instead, because we have access to simulators for our experiments, we use the simpler strategy of running for a large number of runs and ensuring that the confidence intervals do not overlap. </p>
<h2 id="Section-3-Comparing-values-of-epsilon"><a href="#Section-3-Comparing-values-of-epsilon" class="headerlink" title="Section 3: Comparing values of epsilon"></a>Section 3: Comparing values of epsilon</h2><p>Can we do better than an epsilon of 0.1? Let’s try several different values for epsilon and see how they perform. We try different settings of key performance parameters to understand how the agent might perform under different conditions.</p>
<p>Below we run an experiment where we sweep over different values for epsilon:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ---------------</span></span><br><span class="line"><span class="comment"># Discussion Cell</span></span><br><span class="line"><span class="comment"># ---------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Experiment code for different e-greedy</span></span><br><span class="line">epsilons = [<span class="number">0.0</span>, <span class="number">0.01</span>, <span class="number">0.1</span>, <span class="number">0.4</span>]</span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">15</span>, <span class="number">5</span>), dpi= <span class="number">80</span>, facecolor=<span class="string">'w'</span>, edgecolor=<span class="string">'k'</span>)</span><br><span class="line">plt.plot([<span class="number">1.55</span> <span class="keyword">for</span> _ <span class="keyword">in</span> range(num_steps)], linestyle=<span class="string">"--"</span>)</span><br><span class="line"></span><br><span class="line">n_q_values = []</span><br><span class="line">n_averages = []</span><br><span class="line">n_best_actions = []</span><br><span class="line"></span><br><span class="line">num_runs = <span class="number">200</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> epsilon <span class="keyword">in</span> epsilons:</span><br><span class="line">    all_averages = []</span><br><span class="line">    <span class="keyword">for</span> run <span class="keyword">in</span> tqdm(range(num_runs)):</span><br><span class="line">        agent = EpsilonGreedyAgent</span><br><span class="line">        agent_info = &#123;<span class="string">"num_actions"</span>: <span class="number">10</span>, <span class="string">"epsilon"</span>: epsilon&#125;</span><br><span class="line">        env_info = &#123;<span class="string">"random_seed"</span>: run&#125;</span><br><span class="line"></span><br><span class="line">        rl_glue = RLGlue(env, agent)</span><br><span class="line">        rl_glue.rl_init(agent_info, env_info)</span><br><span class="line">        rl_glue.rl_start()</span><br><span class="line">        </span><br><span class="line">        best_arm = np.argmax(rl_glue.environment.arms)</span><br><span class="line"></span><br><span class="line">        scores = [<span class="number">0</span>]</span><br><span class="line">        averages = []</span><br><span class="line">        best_action_chosen = []</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(num_steps):</span><br><span class="line">            reward, state, action, is_terminal = rl_glue.rl_step()</span><br><span class="line">            scores.append(scores[<span class="number">-1</span>] + reward)</span><br><span class="line">            averages.append(scores[<span class="number">-1</span>] / (i + <span class="number">1</span>))</span><br><span class="line">            <span class="keyword">if</span> action == best_arm:</span><br><span class="line">                best_action_chosen.append(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                best_action_chosen.append(<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">if</span> epsilon == <span class="number">0.1</span> <span class="keyword">and</span> run == <span class="number">0</span>:</span><br><span class="line">                n_q_values.append(np.copy(rl_glue.agent.q_values))</span><br><span class="line">        <span class="keyword">if</span> epsilon == <span class="number">0.1</span>:</span><br><span class="line">            n_averages.append(averages)</span><br><span class="line">            n_best_actions.append(best_action_chosen)</span><br><span class="line">        all_averages.append(averages)</span><br><span class="line">        </span><br><span class="line">    plt.plot(np.mean(all_averages, axis=<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">plt.legend([<span class="string">"Best Possible"</span>] + epsilons)</span><br><span class="line">plt.xlabel(<span class="string">"Steps"</span>)</span><br><span class="line">plt.ylabel(<span class="string">"Average reward"</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<pre><code>100%|██████████| 200/200 [00:03&lt;00:00, 58.80it/s]
100%|██████████| 200/200 [00:03&lt;00:00, 59.62it/s]
100%|██████████| 200/200 [00:03&lt;00:00, 61.00it/s]
100%|██████████| 200/200 [00:02&lt;00:00, 70.13it/s]
</code></pre><p><img src="output_33_1.png" alt="png"></p>
<p>Why did 0.1 perform better than 0.01?</p>
<p>If exploration helps why did 0.4 perform worse that 0.0 (the greedy agent)?</p>
<p>Think about these and how you would answer these questions. They are questions in the practice quiz. If you still have questions about it, retake the practice quiz.</p>
<h2 id="Section-4-The-Effect-of-Step-Size"><a href="#Section-4-The-Effect-of-Step-Size" class="headerlink" title="Section 4: The Effect of Step Size"></a>Section 4: The Effect of Step Size</h2><p>In Section 1 of this assignment, we decayed the step size over time based on action-selection counts. The step-size was 1/N(A), where N(A) is the number of times action A was selected. This is the same as computing a sample average. We could also set the step size to be a constant value, such as 0.1. What would be the effect of doing that? And is it better to use a constant or the sample average method? </p>
<p>To investigate this question, let’s start by creating a new agent that has a constant step size. This will be nearly identical to the agent created above. You will use the same code to select the epsilon-greedy action. You will change the update to have a constant step size instead of using the 1/N(A) update.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -----------</span></span><br><span class="line"><span class="comment"># Graded Cell</span></span><br><span class="line"><span class="comment"># -----------</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EpsilonGreedyAgentConstantStepsize</span><span class="params">(main_agent.Agent)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">agent_step</span><span class="params">(self, reward, observation)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Takes one step for the agent. It takes in a reward and observation and </span></span><br><span class="line"><span class="string">        returns the action the agent chooses at that time step.</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        Arguments:</span></span><br><span class="line"><span class="string">        reward -- float, the reward the agent recieved from the environment after taking the last action.</span></span><br><span class="line"><span class="string">        observation -- float, the observed state the agent is in. Do not worry about this as you will not use it</span></span><br><span class="line"><span class="string">                              until future lessons</span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">        current_action -- int, the action chosen by the agent at the current time step.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">### Useful Class Variables ###</span></span><br><span class="line">        <span class="comment"># self.q_values : An array with what the agent believes each of the values of the arm are.</span></span><br><span class="line">        <span class="comment"># self.arm_count : An array with a count of the number of times each arm has been pulled.</span></span><br><span class="line">        <span class="comment"># self.last_action : An int of the action that the agent took on the previous time step.</span></span><br><span class="line">        <span class="comment"># self.step_size : A float which is the current step size for the agent.</span></span><br><span class="line">        <span class="comment"># self.epsilon : The probability an epsilon greedy agent will explore (ranges between 0 and 1)</span></span><br><span class="line">        <span class="comment">#######################</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Update q_values for action taken at previous time step </span></span><br><span class="line">        <span class="comment"># using self.step_size intead of using self.arm_count</span></span><br><span class="line">        <span class="comment"># YOUR CODE HERE</span></span><br><span class="line"><span class="comment">#         raise NotImplementedError()</span></span><br><span class="line">        self.arm_count[self.last_action] += <span class="number">1</span></span><br><span class="line">        self.q_values[self.last_action] = self.q_values[self.last_action] +  self.step_size * (reward - self.q_values[self.last_action])</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Choose action using epsilon greedy. This is the same as you implemented above.</span></span><br><span class="line">        <span class="comment"># YOUR CODE HERE</span></span><br><span class="line"><span class="comment">#         raise NotImplementedError()</span></span><br><span class="line">        _ = np.random.random()</span><br><span class="line">        current_action = argmax(self.q_values) <span class="keyword">if</span> _ &gt;= self.epsilon <span class="keyword">else</span> np.random.randint(<span class="number">0</span>,len(self.q_values))</span><br><span class="line">        </span><br><span class="line">        self.last_action = current_action</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> current_action</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># --------------</span></span><br><span class="line"><span class="comment"># Debugging Cell</span></span><br><span class="line"><span class="comment"># --------------</span></span><br><span class="line"><span class="comment"># Feel free to make any changes to this cell to debug your code</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> step_size <span class="keyword">in</span> [<span class="number">0.01</span>, <span class="number">0.1</span>, <span class="number">0.5</span>, <span class="number">1.0</span>]:</span><br><span class="line">    e_greedy_agent = EpsilonGreedyAgentConstantStepsize()</span><br><span class="line">    e_greedy_agent.q_values = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">1.0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">    e_greedy_agent.num_actions = <span class="number">5</span></span><br><span class="line">    e_greedy_agent.last_action = <span class="number">1</span></span><br><span class="line">    e_greedy_agent.epsilon = <span class="number">0.0</span></span><br><span class="line">    e_greedy_agent.step_size = step_size</span><br><span class="line">    action = e_greedy_agent.agent_step(<span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">assert</span> e_greedy_agent.q_values == [<span class="number">0</span>, step_size, <span class="number">1.0</span>, <span class="number">0</span>, <span class="number">0</span>], <span class="string">"Check that you are updating q_values correctly using the stepsize."</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -----------</span></span><br><span class="line"><span class="comment"># Tested Cell</span></span><br><span class="line"><span class="comment"># -----------</span></span><br><span class="line"><span class="comment"># The contents of the cell will be tested by the autograder.</span></span><br><span class="line"><span class="comment"># If they do not pass here, they will not pass there.</span></span><br><span class="line"></span><br><span class="line">np.random.seed(<span class="number">0</span>)</span><br><span class="line"><span class="comment"># Check Epsilon Greedy with Different Constant Stepsizes</span></span><br><span class="line"><span class="keyword">for</span> step_size <span class="keyword">in</span> [<span class="number">0.01</span>, <span class="number">0.1</span>, <span class="number">0.5</span>, <span class="number">1.0</span>]:</span><br><span class="line">    e_greedy_agent = EpsilonGreedyAgentConstantStepsize()</span><br><span class="line">    e_greedy_agent.q_values = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">1.0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">    e_greedy_agent.num_actions = <span class="number">5</span></span><br><span class="line">    e_greedy_agent.last_action = <span class="number">1</span></span><br><span class="line">    e_greedy_agent.epsilon = <span class="number">0.0</span></span><br><span class="line">    e_greedy_agent.step_size = step_size</span><br><span class="line">    </span><br><span class="line">    action = e_greedy_agent.agent_step(<span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">assert</span> e_greedy_agent.q_values == [<span class="number">0</span>, step_size, <span class="number">1.0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ---------------</span></span><br><span class="line"><span class="comment"># Discussion Cell</span></span><br><span class="line"><span class="comment"># ---------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Experiment code for different step sizes</span></span><br><span class="line">step_sizes = [<span class="number">0.01</span>, <span class="number">0.1</span>, <span class="number">0.5</span>, <span class="number">1.0</span>, <span class="string">'1/N(A)'</span>]</span><br><span class="line"></span><br><span class="line">epsilon = <span class="number">0.1</span></span><br><span class="line">num_steps = <span class="number">1000</span></span><br><span class="line">num_runs = <span class="number">200</span></span><br><span class="line"></span><br><span class="line">fig, ax = plt.subplots(figsize=(<span class="number">15</span>, <span class="number">5</span>), dpi= <span class="number">80</span>, facecolor=<span class="string">'w'</span>, edgecolor=<span class="string">'k'</span>)</span><br><span class="line"></span><br><span class="line">q_values = &#123;step_size: [] <span class="keyword">for</span> step_size <span class="keyword">in</span> step_sizes&#125;</span><br><span class="line">true_values = &#123;step_size: <span class="keyword">None</span> <span class="keyword">for</span> step_size <span class="keyword">in</span> step_sizes&#125;</span><br><span class="line">best_actions = &#123;step_size: [] <span class="keyword">for</span> step_size <span class="keyword">in</span> step_sizes&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> step_size <span class="keyword">in</span> step_sizes:</span><br><span class="line">    all_averages = []</span><br><span class="line">    <span class="keyword">for</span> run <span class="keyword">in</span> tqdm(range(num_runs)):</span><br><span class="line">        np.random.seed(run)</span><br><span class="line">        agent = EpsilonGreedyAgentConstantStepsize <span class="keyword">if</span> step_size != <span class="string">'1/N(A)'</span> <span class="keyword">else</span> EpsilonGreedyAgent</span><br><span class="line">        agent_info = &#123;<span class="string">"num_actions"</span>: <span class="number">10</span>, <span class="string">"epsilon"</span>: epsilon, <span class="string">"step_size"</span>: step_size, <span class="string">"initial_value"</span>: <span class="number">0.0</span>&#125;</span><br><span class="line">        env_info = &#123;&#125;</span><br><span class="line"></span><br><span class="line">        rl_glue = RLGlue(env, agent)</span><br><span class="line">        rl_glue.rl_init(agent_info, env_info)</span><br><span class="line">        rl_glue.rl_start()</span><br><span class="line">        </span><br><span class="line">        best_arm = np.argmax(rl_glue.environment.arms)</span><br><span class="line"></span><br><span class="line">        scores = [<span class="number">0</span>]</span><br><span class="line">        averages = []</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> run == <span class="number">0</span>:</span><br><span class="line">            true_values[step_size] = np.copy(rl_glue.environment.arms)</span><br><span class="line">            </span><br><span class="line">        best_action_chosen = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(num_steps):</span><br><span class="line">            reward, state, action, is_terminal = rl_glue.rl_step()</span><br><span class="line">            scores.append(scores[<span class="number">-1</span>] + reward)</span><br><span class="line">            averages.append(scores[<span class="number">-1</span>] / (i + <span class="number">1</span>))</span><br><span class="line">            <span class="keyword">if</span> action == best_arm:</span><br><span class="line">                best_action_chosen.append(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                best_action_chosen.append(<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">if</span> run == <span class="number">0</span>:</span><br><span class="line">                q_values[step_size].append(np.copy(rl_glue.agent.q_values))</span><br><span class="line">        best_actions[step_size].append(best_action_chosen)</span><br><span class="line">    ax.plot(np.mean(best_actions[step_size], axis=<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">plt.legend(step_sizes)</span><br><span class="line">plt.title(<span class="string">"% Best Arm Pulled"</span>)</span><br><span class="line">plt.xlabel(<span class="string">"Steps"</span>)</span><br><span class="line">plt.ylabel(<span class="string">"% Best Arm Pulled"</span>)</span><br><span class="line">vals = ax.get_yticks()</span><br><span class="line">ax.set_yticklabels([<span class="string">'&#123;:,.2%&#125;'</span>.format(x) <span class="keyword">for</span> x <span class="keyword">in</span> vals])</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<pre><code>100%|██████████| 200/200 [00:03&lt;00:00, 63.14it/s]
100%|██████████| 200/200 [00:03&lt;00:00, 62.84it/s]
100%|██████████| 200/200 [00:03&lt;00:00, 62.57it/s]
100%|██████████| 200/200 [00:03&lt;00:00, 62.70it/s]
100%|██████████| 200/200 [00:03&lt;00:00, 61.82it/s]
</code></pre><p><img src="output_40_1.png" alt="png"></p>
<p>Notice first that we are now plotting the amount of time that the best action is taken rather than the average reward. To better  understand the performance of an agent, it can be useful to measure specific behaviors, beyond just how much reward is accumulated. This measure indicates how close the agent’s behaviour is to optimal.</p>
<p>It seems as though 1/N(A) performed better than the others, in that it reaches a solution where it takes the best action most frequently. Now why might this be? Why did a step size of 0.5 start out better but end up performing worse? Why did a step size of 0.01 perform so poorly?</p>
<p>Let’s dig into this further below. Let’s plot how well each agent tracks the true value, where each agent has a different step size method. You do not have to enter any code here, just follow along.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lock</span></span><br><span class="line"><span class="comment"># ---------------</span></span><br><span class="line"><span class="comment"># Discussion Cell</span></span><br><span class="line"><span class="comment"># ---------------</span></span><br><span class="line">largest = <span class="number">0</span></span><br><span class="line">num_steps = <span class="number">1000</span></span><br><span class="line"><span class="keyword">for</span> step_size <span class="keyword">in</span> step_sizes:</span><br><span class="line">    plt.figure(figsize=(<span class="number">15</span>, <span class="number">5</span>), dpi= <span class="number">80</span>, facecolor=<span class="string">'w'</span>, edgecolor=<span class="string">'k'</span>)</span><br><span class="line">    largest = np.argmax(true_values[step_size])</span><br><span class="line">    plt.plot([true_values[step_size][largest] <span class="keyword">for</span> _ <span class="keyword">in</span> range(num_steps)], linestyle=<span class="string">"--"</span>)</span><br><span class="line">    plt.title(<span class="string">"Step Size: &#123;&#125;"</span>.format(step_size))</span><br><span class="line">    plt.plot(np.array(q_values[step_size])[:, largest])</span><br><span class="line">    plt.legend([<span class="string">"True Expected Value"</span>, <span class="string">"Estimated Value"</span>])</span><br><span class="line">    plt.xlabel(<span class="string">"Steps"</span>)</span><br><span class="line">    plt.ylabel(<span class="string">"Value"</span>)</span><br><span class="line">    plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="output_42_0.png" alt="png"></p>
<p><img src="output_42_1.png" alt="png"></p>
<p><img src="output_42_2.png" alt="png"></p>
<p><img src="output_42_3.png" alt="png"></p>
<p><img src="output_42_4.png" alt="png"></p>
<p>These plots help clarify the performance differences between the different step sizes. A step size of 0.01 makes such small updates that the agent’s value estimate of the best action does not get close to the actual value. Step sizes of 0.5 and 1.0 both get close to the true value quickly, but are very susceptible to stochasticity in the rewards. The updates overcorrect too much towards recent rewards, and so oscillate around the true value. This means that on many steps, the action that pulls the best arm may seem worse than it actually is.  A step size of 0.1 updates fairly quickly to the true value, and does not oscillate as widely around the true values as 0.5 and 1.0. This is one of the reasons that 0.1 performs quite well. Finally we see why 1/N(A) performed well. Early on while the step size is still reasonably high it moves quickly to the true expected value, but as it gets pulled more its step size is reduced which makes it less susceptible to the stochasticity of the rewards.</p>
<p>Does this mean that 1/N(A) is always the best? When might it not be? One possible setting where it might not be as effective is in non-stationary problems. You learned about non-stationarity in the lessons. Non-stationarity means that the environment may change over time. This could manifest itself as continual change over time of the environment, or a sudden change in the environment.</p>
<p>Let’s look at how a sudden change in the reward distributions affects a step size like 1/N(A). This time we will run the environment for 2000 steps, and after 1000 steps we will randomly change the expected value of all of the arms. We compare two agents, both using epsilon-greedy with epsilon = 0.1. One uses a constant step size of 0.1, the other a step size of 1/N(A) that reduces over time. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ---------------</span></span><br><span class="line"><span class="comment"># Discussion Cell</span></span><br><span class="line"><span class="comment"># ---------------</span></span><br><span class="line">epsilon = <span class="number">0.1</span></span><br><span class="line">num_steps = <span class="number">2000</span></span><br><span class="line">num_runs = <span class="number">200</span></span><br><span class="line">step_size = <span class="number">0.1</span></span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">15</span>, <span class="number">5</span>), dpi= <span class="number">80</span>, facecolor=<span class="string">'w'</span>, edgecolor=<span class="string">'k'</span>)</span><br><span class="line">plt.plot([<span class="number">1.55</span> <span class="keyword">for</span> _ <span class="keyword">in</span> range(num_steps)], linestyle=<span class="string">"--"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> agent <span class="keyword">in</span> [EpsilonGreedyAgent, EpsilonGreedyAgentConstantStepsize]:</span><br><span class="line">    all_averages = []</span><br><span class="line">    <span class="keyword">for</span> run <span class="keyword">in</span> tqdm(range(num_runs)):</span><br><span class="line">        agent_info = &#123;<span class="string">"num_actions"</span>: <span class="number">10</span>, <span class="string">"epsilon"</span>: epsilon, <span class="string">"step_size"</span>: step_size&#125;</span><br><span class="line">        np.random.seed(run)</span><br><span class="line">        </span><br><span class="line">        rl_glue = RLGlue(env, agent)</span><br><span class="line">        rl_glue.rl_init(agent_info, env_info)</span><br><span class="line">        rl_glue.rl_start()</span><br><span class="line"></span><br><span class="line">        scores = [<span class="number">0</span>]</span><br><span class="line">        averages = []</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(num_steps):</span><br><span class="line">            reward, state, action, is_terminal = rl_glue.rl_step()</span><br><span class="line">            scores.append(scores[<span class="number">-1</span>] + reward)</span><br><span class="line">            averages.append(scores[<span class="number">-1</span>] / (i + <span class="number">1</span>))</span><br><span class="line">            <span class="keyword">if</span> i == <span class="number">1000</span>:</span><br><span class="line">                rl_glue.environment.arms = np.random.randn(<span class="number">10</span>)</span><br><span class="line">        all_averages.append(averages)</span><br><span class="line">        </span><br><span class="line">    plt.plot(np.mean(all_averages, axis=<span class="number">0</span>))</span><br><span class="line">plt.legend([<span class="string">"Best Possible"</span>, <span class="string">"1/N(A)"</span>, <span class="string">"0.1"</span>])</span><br><span class="line">plt.xlabel(<span class="string">"Steps"</span>)</span><br><span class="line">plt.ylabel(<span class="string">"Average reward"</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<pre><code>100%|██████████| 200/200 [00:06&lt;00:00, 29.43it/s]
100%|██████████| 200/200 [00:06&lt;00:00, 30.10it/s]
</code></pre><p><img src="output_44_1.png" alt="png"></p>
<p>Now the agent with a step size of 1/N(A) performed better at the start but then performed worse when the environment changed! What happened?</p>
<p>Think about what the step size would be after 1000 steps. Let’s say the best action gets chosen 500 times. That means the step size for that action is 1/500 or 0.002. At each step when we update the value of the action and the value is going to move only 0.002 * the error. That is a very tiny adjustment and it will take a long time for it to get to the true value.</p>
<p>The agent with step size 0.1, however, will always update in 1/10th of the direction of the error. This means that on average it will take ten steps for it to update its value to the sample mean.</p>
<p>These are the types of tradeoffs we have to think about in reinforcement learning. A larger step size moves us more quickly toward the true value, but can make our estimated values oscillate around the expected value. A step size that reduces over time can converge to close to the expected value, without oscillating. On the other hand, such a decaying stepsize is not able to adapt to changes in the environment. Nonstationarity—-and the related concept of partial observability—-is a common feature of reinforcement learning problems and when learning online.  </p>
<h2 id="Section-5-Conclusion"><a href="#Section-5-Conclusion" class="headerlink" title="Section 5: Conclusion"></a>Section 5: Conclusion</h2><p>Great work! You have:</p>
<ul>
<li>Implemented your first agent</li>
<li>Learned about the effect of epsilon, an exploration parameter, on the performance of an agent</li>
<li>Learned about the effect of step size on the performance of the agent</li>
<li>Learned about a good experiment practice of averaging across multiple runs</li>
</ul>

      
    </div>
    
    
    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/Question-duplicates/2020/08/23/" rel="next" title="Question duplicates">
                <i class="fa fa-chevron-left"></i> Question duplicates
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/The-K-Armed-Bandit-Problem/2020/09/03/" rel="prev" title="The K-Armed Bandit Problem">
                The K-Armed Bandit Problem <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>Donate article here</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>Donate</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.png" alt="Ruochi Zhang WeChat Pay">
        <p>WeChat Pay</p>
      </div>
    

    

    
      <div id="bitcoin" style="display: inline-block">
        <img id="vemo_qr" src="/images/venmo.png" alt="Ruochi Zhang Bitcoin">
        <p>Venmo(last 4 digits 1570)</p>
      </div>
    

  </div>
</div>

      </div>
    


  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.png" alt="Ruochi Zhang">
            
              <p class="site-author-name" itemprop="name">Ruochi Zhang</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">253</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">44</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">29</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/zhangruochi" target="_blank" title="GitHub rel=" external nofollow"">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:zrc720@gmail.com" target="_blank" title="E-Mail rel=" external nofollow"">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Friend links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.healthinformaticslab.org" title="HILab" target="_blank" rel="external nofollow">HILab</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.shihaizhou.com" title="Rose" target="_blank" rel="external nofollow">Rose</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://blog.csdn.net/cherish_CX/" title="Chunxia" target="_blank" rel="external nofollow">Chunxia</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Assignment-1-Bandits-and-Exploration-Exploitation"><span class="nav-text">Assignment 1: Bandits and Exploration/Exploitation</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Section-0-Preliminaries"><span class="nav-text">Section 0: Preliminaries</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Section-1-Greedy-Agent"><span class="nav-text">Section 1: Greedy Agent</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Section-2-Epsilon-Greedy-Agent"><span class="nav-text">Section 2: Epsilon-Greedy Agent</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Section-2-1-Averaging-Multiple-Runs"><span class="nav-text">Section 2.1 Averaging Multiple Runs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Section-3-Comparing-values-of-epsilon"><span class="nav-text">Section 3: Comparing values of epsilon</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Section-4-The-Effect-of-Step-Size"><span class="nav-text">Section 4: The Effect of Step Size</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Section-5-Conclusion"><span class="nav-text">Section 5: Conclusion</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2019 &mdash; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ruochi Zhang</span>
  
  
</div>








        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'qW3MLcAgcX96sB6qbegeL7rP-gzGzoHsz',
        appKey: 'GL6JvT9DgGxqYrY5Vj6bXVuv',
        lang: 'en',
        placeholder: 'Thank you for your reply',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->


  
  

  
  


  

  

  
</body>
</html>
