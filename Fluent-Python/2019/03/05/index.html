<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="">
<head><meta name="generator" content="Hexo 3.8.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">
<meta name="baidu-site-verification" content="PfeH4jmhwL">
<meta name="google-site-verification" content="A749_BVo91Gbd5oqBRsAAzolnmY_5JCET--CVn3ZQQA">








<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Didot:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Python,字典,函数,数据模型">










<meta name="description" content="This is the note of book named Fluent Python">
<meta name="keywords" content="Python,字典,函数,数据模型">
<meta property="og:type" content="article">
<meta property="og:title" content="Fluent Python">
<meta property="og:url" content="https://zhangruochi.com/Fluent-Python/2019/03/05/index.html">
<meta property="og:site_name" content="RUOCHI">
<meta property="og:description" content="This is the note of book named Fluent Python">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://zhangruochi.com/Fluent-Python/2019/03/05/DBAF8F19D803E115AEC422F6D4E4F04B.png">
<meta property="og:image" content="https://zhangruochi.com/Fluent-Python/2019/03/05/C3428851CF36CA77881134A4708D4841.png">
<meta property="og:image" content="https://zhangruochi.com/Fluent-Python/2019/03/05/8415F855AA68BCF9DCA14B17E1921973.png">
<meta property="og:image" content="https://zhangruochi.com/Fluent-Python/2019/03/05/799D1125CE215336FD672BD8D6FE818A.png">
<meta property="og:image" content="https://zhangruochi.com/Fluent-Python/2019/03/05/C2D3E9BDE8560C1FAA57CFADA8BEF174.png">
<meta property="og:image" content="https://zhangruochi.com/Fluent-Python/2019/03/05/D8F57ABE26A5E48D0E4D5D33C5FFB90D.png">
<meta property="og:image" content="https://zhangruochi.com/Fluent-Python/2019/03/05/B73DD07CE3B22BF761AD94BD0A5B829E.png">
<meta property="og:image" content="https://zhangruochi.com/Fluent-Python/2019/03/05/2FDBB65442D6C9ED48937F7F914DBD25.png">
<meta property="og:image" content="https://zhangruochi.com/Fluent-Python/2019/03/05/63647744ACC5D7C2680D50D4DAEBD9A7.png">
<meta property="og:image" content="https://zhangruochi.com/Fluent-Python/2019/03/05/0CA907EFC52DDB8A7774BFD87DF0E77A.png">
<meta property="og:image" content="https://zhangruochi.com/Fluent-Python/2019/03/05/12BFE0DB402CD77D626966735C85ABDB.png">
<meta property="og:image" content="https://zhangruochi.com/Fluent-Python/2019/03/05/5EF76B560B5DB1316B558712DEFEA398.png">
<meta property="og:image" content="https://zhangruochi.com/Fluent-Python/2019/03/05/86DFFE0BE2BDE94ACDEE9957B1377E07.png">
<meta property="og:image" content="https://zhangruochi.com/Fluent-Python/2019/03/05/0372A461E78029DED0A7D7121A49EAF1.png">
<meta property="og:image" content="https://zhangruochi.com/Fluent-Python/2019/03/05/44DAA05E00DF81F67E96530C9FD4F62D.png">
<meta property="og:image" content="https://zhangruochi.com/Fluent-Python/2019/03/05/F078127CF59F53B4C8F7F39C6BF45A1C.png">
<meta property="og:image" content="https://zhangruochi.com/Fluent-Python/2019/03/05/8FE3ACE51E02FD7F405BE86E1B8346EE.png">
<meta property="og:image" content="https://zhangruochi.com/Fluent-Python/2019/03/05/DA4E95C453BEEAF371768C77B884032F.png">
<meta property="og:updated_time" content="2019-03-29T22:04:47.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Fluent Python">
<meta name="twitter:description" content="This is the note of book named Fluent Python">
<meta name="twitter:image" content="https://zhangruochi.com/Fluent-Python/2019/03/05/DBAF8F19D803E115AEC422F6D4E4F04B.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"hide","offset":12,"b2t":false,"scrollpercent":false,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://zhangruochi.com/Fluent-Python/2019/03/05/">





  <title>Fluent Python | RUOCHI</title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">RUOCHI</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            About
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://zhangruochi.com/Fluent-Python/2019/03/05/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ruochi Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RUOCHI">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">Fluent Python</h2>
        

        <div class="post-meta">
          
          

          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-03-05T12:22:33+08:00">
                2019-03-05
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          

          

          
              <div class="post-description">
                  This is the note of book named Fluent Python
              </div>
          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="字典"><a href="#字典" class="headerlink" title="字典"></a>字典</h1><h2 id="泛映射类型"><a href="#泛映射类型" class="headerlink" title="泛映射类型"></a>泛映射类型</h2><p>Mapping 和 MutableMapping 这两个抽象基类，提供形式化接口<br><img src="DBAF8F19D803E115AEC422F6D4E4F04B.png" alt="Screen Shot 2018-09-29 at 10.44.50.png"></p>
<h3 id="什么是可散列数据？"><a href="#什么是可散列数据？" class="headerlink" title="什么是可散列数据？"></a>什么是可散列数据？</h3><ul>
<li>原子不可变数据类型（str，bytes 和 number）</li>
<li>在生命周期类，散列值不变的类型。需要有_<em>hash_<em> 和 __qe\</em></em> 方法</li>
<li><p>元组类型需要元组里每一个值都是可散列类型   </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a = (<span class="string">"a"</span>,<span class="string">"b"</span>,(<span class="string">"c"</span>,<span class="string">"d"</span>))  <span class="comment">#-&gt;hashable</span></span><br><span class="line">a = (<span class="string">"a"</span>,<span class="string">"b"</span>,[<span class="string">"c"</span>,<span class="string">"d"</span>])  <span class="comment">#-&gt; not hashable</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>用户自定义的对象都是可散列的，因为散列值就是id()函数的值。如果自定义对象实现了_<em>eq_</em>方法，并且这个用到了这个对象的内部状态的话，内部状态必须不可变。</p>
</li>
</ul>
<h2 id="字典推导"><a href="#字典推导" class="headerlink" title="字典推导"></a>字典推导</h2><p>可以从任何键值对作为作为元素的可迭代对象中推导<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">data = [(<span class="string">"zhang"</span>,<span class="number">23</span>),[<span class="string">"li"</span>,<span class="number">23</span>],[<span class="string">"ding"</span>,<span class="number">24</span>],&#123;<span class="string">"huang"</span>,<span class="number">24</span>&#125;]</span><br><span class="line">data_dict = &#123;name:age <span class="keyword">for</span> name,age <span class="keyword">in</span> data&#125;</span><br><span class="line">print(data_dict)   <span class="comment">#-&gt; &#123;'zhang': 23, 'li': 23, 'ding': 24, 24: 'huang'&#125;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="常用的映射方法"><a href="#常用的映射方法" class="headerlink" title="常用的映射方法"></a>常用的映射方法</h2><ul>
<li>d.clear()</li>
<li>d.</li>
<li>_<em>contains_</em>(k)</li>
<li>d.copy()  #潜赋值</li>
<li>d._<em>delitem_</em>(k)</li>
<li>d.get(k, default)</li>
<li>d.items()</li>
<li>d._<em>iter_</em>()</li>
<li>d.keys()</li>
<li>d._<em>len_</em>()</li>
<li>d.pop(k)</li>
<li>d.popitem()</li>
<li>d._<em>reversed_</em>() #仅针对 OrdereDidic</li>
<li>d.setdefault(k,[default]) #如果存在键k,将对应的值设置为default,然后返回.如果没有，d[k] = default.</li>
<li>d._<em>setitem_</em>(k,v)</li>
<li>d.values()</li>
</ul>
<h3 id="setdefault-用法"><a href="#setdefault-用法" class="headerlink" title="setdefault 用法"></a>setdefault 用法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">my_dict.setdefault(key,[]).append(value)  <span class="comment">#效率更高</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ket <span class="keyword">not</span> <span class="keyword">in</span> my_dict:</span><br><span class="line">    my_dict[key] = []</span><br><span class="line">my_dict[key].append(new_value)</span><br></pre></td></tr></table></figure>
<h2 id="映射的弹性查询"><a href="#映射的弹性查询" class="headerlink" title="映射的弹性查询"></a>映射的弹性查询</h2><h3 id="defaultdict"><a href="#defaultdict" class="headerlink" title="defaultdict"></a>defaultdict</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line">a = defaultdict(list)</span><br></pre></td></tr></table></figure>
<p>list可调用对象存储在default<em>factory中，当a[k]，k不存在时，a._<em>getitem_<em> 会调用 _<em>miss\</em></em> 方法（只会在__getitem\</em></em>里调用），然后利用default_factory生成返回值。</p>
<h3 id="自己创建继承-dict-类型，然后充血-miss-方法"><a href="#自己创建继承-dict-类型，然后充血-miss-方法" class="headerlink" title="自己创建继承 dict 类型，然后充血_miss_方法"></a>自己创建继承 dict 类型，然后充血_<em>miss_</em>方法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StrDict</span><span class="params">(dict)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__missing__</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(key, str):</span><br><span class="line">            <span class="keyword">return</span> KeyError(key)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> self[str(key)]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, key, default=None)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> self[key]</span><br><span class="line">        <span class="keyword">except</span> keyError:</span><br><span class="line">            <span class="keyword">return</span> default</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__contains__</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> key <span class="keyword">in</span> self.keys() <span class="keyword">or</span> str(key) <span class="keyword">in</span> self.keys()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    a = StrDict(&#123;<span class="string">"1"</span>: <span class="number">2</span>&#125;)</span><br><span class="line">    print(a[<span class="number">1</span>])</span><br></pre></td></tr></table></figure>
<p>k in my_dict.keys() (.items(), .values())这种操作很快，因为返回的是视图，类似集合。</p>
<h2 id="字典的变种"><a href="#字典的变种" class="headerlink" title="字典的变种"></a>字典的变种</h2><ul>
<li>collections.OrderedDict 添加元素时会保持顺序，popitem默认返回最后一个元素，popitem(last=False)默认返回第一个元素</li>
<li>collections.ChainMap 容纳多个不同的映射对象，在键查找时，会当做整体查找。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> builtins</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> ChainMap</span><br><span class="line">pylookup = ChainMap(locals(),globals(),vars(builtins))</span><br><span class="line">print(pylookup)</span><br></pre></td></tr></table></figure>
<ul>
<li>collections.Counter 给每个键会准备一个计数器<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line">a = Counter(<span class="string">"aabbccdd"</span>)</span><br><span class="line">print(a)</span><br><span class="line">a.update(<span class="string">"aacc"</span>)</span><br><span class="line">print(a)</span><br><span class="line">print(a.most_common(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#output</span></span><br><span class="line"><span class="comment">#Counter(&#123;'a': 2, 'b': 2, 'c': 2, 'd': 2&#125;)</span></span><br><span class="line"><span class="comment">#Counter(&#123;'a': 4, 'c': 4, 'b': 2, 'd': 2&#125;)</span></span><br><span class="line"><span class="comment">#[('a', 4)]</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="子类化-UserDict"><a href="#子类化-UserDict" class="headerlink" title="子类化 UserDict"></a>子类化 UserDict</h2><p>含有data属性，是dict实例，是存储数据的地方.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StrDict</span><span class="params">(dict)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__missing__</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(key, str):</span><br><span class="line">            <span class="keyword">return</span> KeyError(key)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> self[str(key)]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, key, default=None)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> self[key]</span><br><span class="line">        <span class="keyword">except</span> keyError:</span><br><span class="line">            <span class="keyword">return</span> default</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setitem__</span><span class="params">(self, key,item)</span>:</span></span><br><span class="line">        self.data[str(key)] = item</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__contains__</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> str(key) <span class="keyword">in</span> self.data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    a = StrDict(&#123;<span class="string">"1"</span>: <span class="number">2</span>&#125;)</span><br><span class="line">    print(a[<span class="number">1</span>])</span><br></pre></td></tr></table></figure></p>
<h2 id="不可变的映射类型"><a href="#不可变的映射类型" class="headerlink" title="不可变的映射类型"></a>不可变的映射类型</h2><p>MappingProxyType 返回动态内存视图，不能靠视图改变原对象，但是原对象的更改可以由视图表现出来</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> types <span class="keyword">import</span> MappingProxyType</span><br><span class="line">d = &#123;<span class="number">1</span>:<span class="string">'A'</span>&#125;</span><br><span class="line">d_proxy = MappingProxyType(d)</span><br><span class="line">print(d_proxy[<span class="number">1</span>])</span><br><span class="line"><span class="comment">#d_proxy[2] = 'B'  #-&gt;error</span></span><br><span class="line">d[<span class="number">2</span>] = <span class="string">'B'</span></span><br><span class="line">print(d_proxy)</span><br></pre></td></tr></table></figure>
<h2 id="集合论"><a href="#集合论" class="headerlink" title="集合论"></a>集合论</h2><ul>
<li>set 对象中的元素必须是可散列的，但是 set 对象本身是不可散列的，frozenset是可散列的对象。</li>
<li>| 合集</li>
<li>- 差集</li>
<li>&amp; 交集</li>
<li>创建空集合要用set(), 如果用{}则是创建空字典</li>
<li>集合推导<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;char(i) <span class="keyword">for</span> i range(<span class="number">100</span>)&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="集合的运算"><a href="#集合的运算" class="headerlink" title="集合的运算"></a>集合的运算</h3><p><img src="C3428851CF36CA77881134A4708D4841.png" alt="Screen Shot 2018-09-29 at 14.33.28.png"><br><img src="8415F855AA68BCF9DCA14B17E1921973.png" alt="Screen Shot 2018-09-29 at 14.33.39.png"></p>
<h3 id="集合的比较运算"><a href="#集合的比较运算" class="headerlink" title="集合的比较运算"></a>集合的比较运算</h3><p><img src="799D1125CE215336FD672BD8D6FE818A.png" alt="Screen Shot 2018-09-29 at 14.33.04.png"><br><img src="C2D3E9BDE8560C1FAA57CFADA8BEF174.png" alt="Screen Shot 2018-09-29 at 14.31.57.png"></p>
<h2 id="dict-set-list效率比较"><a href="#dict-set-list效率比较" class="headerlink" title="dict set list效率比较"></a>dict set list效率比较</h2><p><strong>查找元素，dict 和 set 有强大的散列表做支撑，速度非常快</strong></p>
<h2 id="散列表原理"><a href="#散列表原理" class="headerlink" title="散列表原理"></a>散列表原理</h2><p>my_dict[key], 现根据 hash(key)， 根据最低几位去散列表里查找表元。如为空，返回 error；若有表元，则表元中存在 foundkey:foundvalue. 若 foundkey == key, 返回 foundvalue。若不等，取 hash(key)的高几位再去找。循环。<br><img src="D8F57ABE26A5E48D0E4D5D33C5FFB90D.png" alt="Screen Shot 2018-09-29 at 15.02.31.png"></p>
<h2 id="dict-conclusion"><a href="#dict-conclusion" class="headerlink" title="dict conclusion"></a>dict conclusion</h2><ul>
<li>键必须是可散列的<br>一个可散列的对象必须满足<ul>
<li>_<em>hash_</em>()方法返回的值不变</li>
<li>_<em>eq_</em>()可做相等判断</li>
<li>a == b， 则 hash(a) == hash(b)</li>
</ul>
</li>
<li>字典内存开销巨大<br>  字典使用散列表，散列表是稀疏的。</li>
<li>键查询很快<br>  空间换时间</li>
<li>添加新键可能会改变已有的顺序</li>
</ul>
<h2 id="set-conclusion"><a href="#set-conclusion" class="headerlink" title="set conclusion"></a>set conclusion</h2><ul>
<li>集合元素必须是可散列的<br>一个可散列的对象必须满足<ul>
<li>_<em>hash_</em>()方法返回的值不变</li>
<li>_<em>eq_</em>()可做相等判断</li>
<li>a == b， 则 hash(a) == hash(b)</li>
</ul>
</li>
<li>集合内存开销巨大<br>  字典使用散列表，散列表是稀疏的。</li>
<li>高效判断是否包含<br>  空间换时间</li>
<li>添加新元素可能会改变已有的顺序</li>
</ul>
<h1 id="序列模型"><a href="#序列模型" class="headerlink" title="序列模型"></a>序列模型</h1><h2 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h2><ul>
<li>容器序列<br>  list, tuple, collections.deque 等，存放对象的引用</li>
<li>扁平序列<br>  str, bytes, bytearray, memoryview, array.array 实际是一段连续的内存空间</li>
</ul>
<p>或者</p>
<ul>
<li>可变序列<br>  list, bytearray, array.array, collection.deque, memeoryview</li>
<li>不可变序列<br>  tuple, str, bytes.</li>
</ul>
<p><img src="B73DD07CE3B22BF761AD94BD0A5B829E.png" alt="Screen Shot 2018-09-28 at 11.39.07.png"></p>
<h2 id="列表推倒与生成器"><a href="#列表推倒与生成器" class="headerlink" title="列表推倒与生成器"></a>列表推倒与生成器</h2><h3 id="列表推倒"><a href="#列表推倒" class="headerlink" title="列表推倒"></a>列表推倒</h3><ul>
<li>不存在变量泄露的问题</li>
<li>可对元素过滤和加工 类似 map/filter 的功能</li>
<li>可计算笛卡尔积<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">'a'</span></span><br><span class="line">symbols = <span class="string">"abcde"</span></span><br><span class="line">beyond_ascii = [ord(s) <span class="keyword">for</span> s <span class="keyword">in</span> symbols <span class="keyword">if</span> ord(s) &gt; <span class="number">10</span>]</span><br><span class="line">print(s) <span class="comment"># s = 'a'</span></span><br><span class="line"></span><br><span class="line">colors = [<span class="string">'b'</span>,<span class="string">'w'</span>]</span><br><span class="line">sizes = [<span class="string">'S'</span>,<span class="string">'M'</span>,<span class="string">'L'</span>]</span><br><span class="line">tshirts = [(color,size) <span class="keyword">for</span> color <span class="keyword">in</span> colors <span class="keyword">for</span> size <span class="keyword">in</span> sizes]</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="生成器表达式"><a href="#生成器表达式" class="headerlink" title="生成器表达式"></a>生成器表达式</h3><ul>
<li>跟列表推倒差不多，把方括号换成圆括号</li>
<li>生成器表达式遵守迭代器协议，可以逐个产出元素，节省内存<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">colors = [<span class="string">'b'</span>,<span class="string">'w'</span>]</span><br><span class="line">sizes = [<span class="string">'S'</span>,<span class="string">'M'</span>,<span class="string">'L'</span>]</span><br><span class="line"><span class="keyword">for</span> tshirt <span class="keyword">in</span> ((color,size) <span class="keyword">for</span> color <span class="keyword">in</span> colors <span class="keyword">for</span> size <span class="keyword">in</span> sizes):</span><br><span class="line">    print(tshirt)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>生成器表达式逐个产出元素，内存中不会一次性产出6个 tshirt 的列表</strong></p>
<h2 id="元组"><a href="#元组" class="headerlink" title="元组"></a>元组</h2><h3 id="元组与记录"><a href="#元组与记录" class="headerlink" title="元组与记录"></a>元组与记录</h3><p>元组其实是没有字段名的记录，元组中的每个元素都存放了记录中一个字段的数据<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">city,year,pop,cha,area = (<span class="string">'Tokyo'</span>,<span class="number">2003</span>,<span class="number">32450</span>,<span class="number">0.66</span>,<span class="number">8014</span>)</span><br></pre></td></tr></table></figure></p>
<h3 id="元组拆包"><a href="#元组拆包" class="headerlink" title="元组拆包"></a>元组拆包</h3><ul>
<li>元组拆包可以运用到任何可迭代的对象上，唯一的要求是可迭代对象的元素数量必须与接收这些元素的变量数量一致。</li>
<li>可用*来表示忽略多余的元组</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a,b,*rest = range(<span class="number">5</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>*运算可以把可迭代对象拆开作为函数的参数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">divmod(<span class="number">20</span>,<span class="number">8</span>) <span class="comment">#-&gt;(2,4)</span></span><br><span class="line">t = (<span class="number">20</span>,<span class="number">8</span>)</span><br><span class="line">divmod(*t) <span class="comment">#-&gt;(2,4)</span></span><br></pre></td></tr></table></figure>
<h3 id="嵌套拆包"><a href="#嵌套拆包" class="headerlink" title="嵌套拆包"></a>嵌套拆包</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">metro_areas = [(<span class="string">'Tokyo'</span>,<span class="string">'JP'</span>,<span class="number">36.933</span>,(<span class="number">35.689</span>,<span class="number">139.691</span>)),(<span class="string">'Beijing'</span>,<span class="string">'CH'</span>,<span class="number">36.933</span>,(<span class="number">35.689</span>,<span class="number">139.691</span>))]</span><br><span class="line"><span class="keyword">for</span> name,cc,pop,(lat,long) <span class="keyword">in</span> metro_areas:</span><br><span class="line">    print(name)</span><br></pre></td></tr></table></figure>
<h3 id="具名元组"><a href="#具名元组" class="headerlink" title="具名元组"></a>具名元组</h3><p>collections.namedtuple 是一个工厂函数,可以用来创建一个带字段名的元组和一个有名字的类,该类的实例所消耗的内存和元组是一样的,因为字段名都被存在对应的类里面。<strong>比普通的类消耗的内存要小.</strong></p>
<ul>
<li>具名元组具有专有的属性和方法，如_fields类属性，类方法_make(iterable),实例方法_asdict().<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line">Person = namedtuple(<span class="string">'P'</span>,[<span class="string">'name'</span>,<span class="string">'sex'</span>])</span><br><span class="line">print(Person._fields)</span><br><span class="line">iterable = (<span class="string">"zhangruochi"</span>,<span class="string">"male"</span>)</span><br><span class="line">me =  Person._make(iterable)</span><br><span class="line">print(me._asdict())</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="作为不可变列表的元组"><a href="#作为不可变列表的元组" class="headerlink" title="作为不可变列表的元组"></a>作为不可变列表的元组</h3><p>元组除了没有列表元素的增减方法，支持列表的其他所有方法<br><img src="2FDBB65442D6C9ED48937F7F914DBD25.png" alt="Screen Shot 2018-09-28 at 13.22.43.png"><br><img src="63647744ACC5D7C2680D50D4DAEBD9A7.png" alt="Screen Shot 2018-09-28 at 13.23.08.png"></p>
<h2 id="切片"><a href="#切片" class="headerlink" title="切片"></a>切片</h2><p>切片忽略最后一个元素的好处</p>
<ul>
<li>最后一个元素时, 只有通过最后一个元素直接看出切片区间里有几个元素</li>
<li>起始和结束元素都可见时， stop - start 快速计算出区间元素的个数</li>
<li>通过一个元素直接把列表分成两段a[:x],a[x:]</li>
</ul>
<h3 id="对象切片"><a href="#对象切片" class="headerlink" title="对象切片"></a>对象切片</h3><p>seq[start:stop:step] -&gt; seq._<em>getitem_</em>(slice(start,stop,end))<br>因此可以自定义切片对象:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">my_slice = slice(<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line">seq = range(<span class="number">10</span>)</span><br><span class="line">sub_seq = seq[my_slice]</span><br></pre></td></tr></table></figure></p>
<h3 id="多维切片"><a href="#多维切片" class="headerlink" title="多维切片"></a>多维切片</h3><p>内置的序列类型只支持一维的索引，外部库 numpy 之类的可以支持二维索引<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a[i,j]</span><br><span class="line">a[:,i:j]</span><br></pre></td></tr></table></figure></p>
<h3 id="切片赋值"><a href="#切片赋值" class="headerlink" title="切片赋值"></a>切片赋值</h3><p>把切片放在负值语句的左边，就可以对切片进行操作<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">l = list(range(<span class="number">10</span>))</span><br><span class="line">l[<span class="number">2</span>:<span class="number">5</span>] = [<span class="number">20</span>,<span class="number">30</span>]</span><br><span class="line"><span class="keyword">del</span> l[<span class="number">5</span>:<span class="number">7</span>]</span><br></pre></td></tr></table></figure></p>
<h2 id="对序列对象使用-和"><a href="#对序列对象使用-和" class="headerlink" title="对序列对象使用+和*"></a>对序列对象使用+和*</h2><p><strong>+和*都遵守不修改原对象，而构建新对象的规律</strong><br>注意：</p>
<p>用[[]]*3来初始化由列表组成的列表，但是列表里其实包含的是3个对同意对象的引用<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">a = [[<span class="string">"_"</span>]*<span class="number">3</span>]*<span class="number">3</span></span><br><span class="line">a[<span class="number">1</span>][<span class="number">2</span>] = <span class="string">"x"</span></span><br><span class="line">print(a) <span class="comment">#-&gt; [['_', '_', 'x'], ['_', '_', 'x'], ['_', '_', 'x']]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#正确写法</span></span><br><span class="line">a = [[<span class="string">"_"</span>]*<span class="number">3</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>)]</span><br><span class="line">a[<span class="number">1</span>][<span class="number">2</span>] = <span class="string">"x"</span></span><br><span class="line">print(a) <span class="comment">#-&gt; [['_', '_', '_'], ['_', '_', 'x'], ['_', '_', '_']]</span></span><br></pre></td></tr></table></figure></p>
<h3 id="序列的增量赋值"><a href="#序列的增量赋值" class="headerlink" title="序列的增量赋值"></a>序列的增量赋值</h3><p>+= 背后的特殊方法是_<em>iadd_<em>(就地加发)， 但是如果这个类没有实现_<em>iadd_</em>时，Python解释器会退而使用__add\</em></em></p>
<ul>
<li>对于可变序列a, a+=b 等同于 a.extend(b)</li>
<li>对于不可变序列a, a+=b 等同于 a = a+b</li>
</ul>
<p><strong>对不可变对象进行重复拼接操作会导致效率低下，因为每次都有新对象生成，还要复制元素到新对象</strong></p>
<p>一个 += 的谜题<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">t = (&quot;a&quot;,&quot;b&quot;,[&quot;c&quot;])</span><br><span class="line">t[2] += [&quot;d&quot;]</span><br></pre></td></tr></table></figure></p>
<p>既抛出异常又修改了t<br><img src="0CA907EFC52DDB8A7774BFD87DF0E77A.png" alt="Screen Shot 2018-09-28 at 14.12.41.png"><br><img src="12BFE0DB402CD77D626966735C85ABDB.png" alt="Screen Shot 2018-09-28 at 14.12.47.png"><br>教训：</p>
<ul>
<li>不要把可变对象放在不可变对象里面</li>
<li>增量赋值不是原子操作</li>
</ul>
<h2 id="序列对象的排序"><a href="#序列对象的排序" class="headerlink" title="序列对象的排序"></a>序列对象的排序</h2><h3 id="就地排序和负值排序"><a href="#就地排序和负值排序" class="headerlink" title="就地排序和负值排序"></a>就地排序和负值排序</h3><ul>
<li>list.sort()就地排序</li>
<li>sorted(list) 会赋值一份新的序列对像</li>
<li>Python排序算法Timsort的时间复杂度为nlog(n)</li>
</ul>
<h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><ul>
<li>reverse, 如设定为True, 被排序的对象会以降序输出</li>
<li>key, 以函数为参数，这个函数会应用在每个元素上<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sorted(list,key = len, reverse = <span class="keyword">True</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="利用bisect-管理已排序的序列"><a href="#利用bisect-管理已排序的序列" class="headerlink" title="利用bisect 管理已排序的序列"></a>利用bisect 管理已排序的序列</h2><ul>
<li>bisect 利用二分查找插入元素的位置</li>
<li>insort 利用 bisect 查找位置然后插入元素</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span>  bisect <span class="keyword">import</span> *</span><br><span class="line">a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#bisect = bisect_left</span></span><br><span class="line">index_left = bisect_left(a,<span class="number">3</span>)</span><br><span class="line">index_right = bisect_right(a,<span class="number">3.0</span>)</span><br><span class="line">print(index_left,index_right)  <span class="comment">#-&gt; 2 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#insort = insort_left</span></span><br><span class="line">insort_left(a,<span class="number">3</span>)</span><br><span class="line">insort_right(a,<span class="number">3.0</span>)</span><br><span class="line">print(a)  <span class="comment">#-&gt;[1, 2, 3, 3, 3.0, 4, 5, 6, 7]</span></span><br></pre></td></tr></table></figure>
<h2 id="list的可替换对象"><a href="#list的可替换对象" class="headerlink" title="list的可替换对象"></a>list的可替换对象</h2><h3 id="array-array"><a href="#array-array" class="headerlink" title="array.array"></a>array.array</h3><p>Python数组跟 C 语言数组一样精简, 如果我们需要一个只包含数字的列表,用 array.array会比list 效率更高，且array支持所有可变序列的操作.</p>
<ul>
<li>array.array需要类型码作为参数来表示底层的 C 语言需要存放怎样的数据. 如’b’表示有符号的字符.</li>
<li><p>数组还提供更多的读取文件和存入文件的方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> array <span class="keyword">import</span> array</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> random</span><br><span class="line">floats = array(<span class="string">'d'</span>,(random() <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>**<span class="number">7</span>)))</span><br><span class="line">print(floats[<span class="number">-1</span>])</span><br><span class="line">floats.tofile(<span class="string">"floats.bin"</span>,<span class="string">"wb"</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>pickle.dump 也可以快速序列化数字类型，速度与 array.tofile()几乎一样快, pickle 还支持其他的数据类型</p>
</li>
<li>但是从Python3.4开始, 数组不再支持就地排序, 如果排序需要新建数组 a = array(a.typecode,sorted(array))</li>
</ul>
<h2 id="内存视图"><a href="#内存视图" class="headerlink" title="内存视图"></a>内存视图</h2><p>memoryview 能够让你在不复制内存的条件下,在数据结构之间共享内存<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> (<span class="number">100000</span>, <span class="number">200000</span>, <span class="number">300000</span>, <span class="number">400000</span>):</span><br><span class="line">    data = <span class="string">'x'</span>*n</span><br><span class="line">    start = time.time()</span><br><span class="line">    b = data</span><br><span class="line">    <span class="keyword">while</span> b:</span><br><span class="line">        b = b[<span class="number">1</span>:]</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'bytes'</span>, n, time.time()-start</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> (<span class="number">100000</span>, <span class="number">200000</span>, <span class="number">300000</span>, <span class="number">400000</span>):</span><br><span class="line">    data = <span class="string">'x'</span>*n</span><br><span class="line">    start = time.time()</span><br><span class="line">    b = memoryview(data)</span><br><span class="line">    <span class="keyword">while</span> b:</span><br><span class="line">        b = b[<span class="number">1</span>:]</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'memoryview'</span>, n, time.time()-start</span><br><span class="line">    </span><br><span class="line"><span class="string">"""output</span></span><br><span class="line"><span class="string">bytes 100000 0.240149021149</span></span><br><span class="line"><span class="string">bytes 200000 1.04921603203</span></span><br><span class="line"><span class="string">bytes 300000 2.66688489914</span></span><br><span class="line"><span class="string">bytes 400000 4.83206987381</span></span><br><span class="line"><span class="string">memoryview 100000 0.011647939682</span></span><br><span class="line"><span class="string">memoryview 200000 0.0258820056915</span></span><br><span class="line"><span class="string">memoryview 300000 0.0385529994965</span></span><br><span class="line"><span class="string">memoryview 400000 0.0550448894501</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure></p>
<h3 id="memoryview-cast-可以利用不同的方式读写同一块内存"><a href="#memoryview-cast-可以利用不同的方式读写同一块内存" class="headerlink" title="memoryview.cast 可以利用不同的方式读写同一块内存"></a>memoryview.cast 可以利用不同的方式读写同一块内存</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> array</span><br><span class="line">numbers = array.array(<span class="string">"h"</span>,[<span class="number">-2</span>,<span class="number">-1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>])</span><br><span class="line">memv = memoryview(numbers)</span><br><span class="line">print(memv[<span class="number">0</span>])  <span class="comment">#-&gt; -2</span></span><br><span class="line">memv_oct = memv.cast(<span class="string">'B'</span>)</span><br><span class="line">print(memv_oct.tolist()) <span class="comment">#-&gt; [254, 255, 255, 255, 0, 0, 1, 0, 2, 0</span></span><br><span class="line">memv_oct[<span class="number">4</span>] = <span class="number">1</span></span><br><span class="line">print(numbers)   <span class="comment">#-&gt; array('h', [-2, -1, 1, 1, 2])</span></span><br><span class="line"></span><br><span class="line">print(array.array(<span class="string">'H'</span>, [<span class="number">1</span>]).tostring())  <span class="comment">#-&gt; b'\x01\x00' python使用大端法，取高字节数据存放在低地址</span></span><br></pre></td></tr></table></figure>
<p>计算机存储的大端法和小端法</p>
<blockquote>
<p>  在计算机内存中，通常是以字节（Byte），也就是 8 个位（Bit）为基本存储单元（也有以 16 位为基本存储单元的）。对于跨越多个字节的数据类型（比如 int 长 4 个字节），如何在内存中对这些字节进行排序有两种常见的方法：大端法（Big-endian）和小端法（Little-endian）。</p>
</blockquote>
<p>不管是大端法还是小端法存储，计算机在内存中存放数据的顺序都是从低地址到高地址，所不同的是首先取低字节的数据存放在低地址还是取高字节数据存放在低地址。</p>
<ul>
<li>若首先取高字节的数据存放在低地址，则是大端法；</li>
<li>若首先取低字节的数据存放在低地址，则是小端法。</li>
</ul>
<h2 id="双向队列和其他形式的队列"><a href="#双向队列和其他形式的队列" class="headerlink" title="双向队列和其他形式的队列"></a>双向队列和其他形式的队列</h2><h3 id="collections-deque"><a href="#collections-deque" class="headerlink" title="collections.deque"></a>collections.deque</h3><p>利用 append 和 pop(0) 的方法, 我们可以把 list 当做 stack 来使用. <strong>但是 pop(0) 的时间复杂度为n，效率低下.</strong></p>
<blockquote>
<p>collections.deque类是一个线程安全，可以快速从两段添加或者删除元素的数据类型.</p>
</blockquote>
<p>对stackd的模拟<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"></span><br><span class="line">array = deque(range(<span class="number">10</span>),maxlen = <span class="number">10</span>)</span><br><span class="line">array.rotate(<span class="number">3</span>)</span><br><span class="line">print(array)  <span class="comment">#-&gt; deque([7, 8, 9, 0, 1, 2, 3, 4, 5, 6], maxlen=10)</span></span><br><span class="line">array.append(<span class="number">-1</span>)  <span class="comment">#-&gt; deque([8, 9, 0, 1, 2, 3, 4, 5, 6, -1], maxlen=10)</span></span><br><span class="line">print(array)</span><br><span class="line">array.popleft() <span class="comment">#-&gt; deque([9, 0, 1, 2, 3, 4, 5, 6, -1], maxlen=10)</span></span><br><span class="line">print(array)</span><br></pre></td></tr></table></figure></p>
<h3 id="queue"><a href="#queue" class="headerlink" title="queue"></a>queue</h3><p>提供了同步(线程安全)类 Queue, LifoQueue 和 PriorityQueue, 不同线程可以利用这些数据来交换信息。具有 maxsize参数，超出容量时queue会被锁住.</p>
<h3 id="heapq"><a href="#heapq" class="headerlink" title="heapq"></a>heapq</h3><p>让用户可以把可变序列当做堆队列或者优先队列使用.</p>
<h1 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h1><h2 id="一等对象"><a href="#一等对象" class="headerlink" title="一等对象"></a>一等对象</h2><p>编程语言里一等对象的定义:</p>
<ol>
<li>运行时创建</li>
<li>能赋值给变量或数据结构中的元素</li>
<li>能作为参数传递</li>
<li>能作为函数返回值</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">factorial</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="string">'''return n!'''</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">if</span> n&lt;<span class="number">2</span> <span class="keyword">else</span> n * factorial(n<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(factorial.__doc__) <span class="comment"># -&gt; return n!</span></span><br><span class="line">print(type(factorial))  <span class="comment"># -&gt; &lt;class 'function'&gt;</span></span><br><span class="line"></span><br><span class="line">fact = factorial</span><br><span class="line">print(fact(<span class="number">5</span>))   <span class="comment">#-&gt; 120</span></span><br><span class="line"></span><br><span class="line">print(list(map(fact,[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]))) <span class="comment">#-&gt; [1, 2, 6]</span></span><br></pre></td></tr></table></figure>
<h2 id="高阶函数"><a href="#高阶函数" class="headerlink" title="高阶函数"></a>高阶函数</h2><p>介绍函数为参数，或者把函数作为返回结果的函数就是高阶函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fruits = [<span class="string">"apple"</span>,<span class="string">"pear"</span>,<span class="string">"cherry"</span>,<span class="string">"fig"</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 长度排序</span></span><br><span class="line">print(sorted(fruits,key = len))  <span class="comment">#-&gt; ['fig', 'pear', 'apple', 'cherry']</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 逆序</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reverse</span><span class="params">(word)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> word[::<span class="number">-1</span>]</span><br><span class="line">print(sorted(fruits,key = reverse))    <span class="comment">#-&gt; ['apple', 'fig', 'pear', 'cherry']</span></span><br></pre></td></tr></table></figure>
<h3 id="map-filter-reduce-极其替代品"><a href="#map-filter-reduce-极其替代品" class="headerlink" title="map,filter,reduce 极其替代品"></a>map,filter,reduce 极其替代品</h3><ul>
<li><p>列表推导式比map与filter连用更清晰易懂</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(list(map(fact,filter(<span class="keyword">lambda</span> x : x%<span class="number">2</span>, range(<span class="number">6</span>))))) <span class="comment"># -&gt; [1, 6, 120]</span></span><br><span class="line">print([fact(i) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">6</span>) <span class="keyword">if</span> i % <span class="number">2</span>])   <span class="comment"># -&gt; [1, 6, 120]</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>sum 比 reduce(add,[]) 更易懂</p>
</li>
<li><p>any,all也是内置的规约函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(all([<span class="keyword">True</span>,<span class="keyword">True</span>,<span class="keyword">False</span>]))   <span class="comment"># -&gt; False</span></span><br><span class="line">print(any([<span class="keyword">True</span>,<span class="keyword">False</span>,<span class="keyword">True</span>]))   <span class="comment"># -&gt; True</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="lambda-表达式"><a href="#lambda-表达式" class="headerlink" title="lambda 表达式"></a>lambda 表达式</h3><p>在 Python内创建匿名函数<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fruits = [<span class="string">"apple"</span>,<span class="string">"pear"</span>,<span class="string">"cherry"</span>,<span class="string">"fig"</span>]</span><br><span class="line">print(sorted(fruits,key = <span class="keyword">lambda</span> word: word[::<span class="number">-1</span>]))</span><br></pre></td></tr></table></figure></p>
<h3 id="七种可调用对象"><a href="#七种可调用对象" class="headerlink" title="七种可调用对象"></a>七种可调用对象</h3><p><img src="5EF76B560B5DB1316B558712DEFEA398.png" alt="Screen Shot 2018-10-12 at 19.35.09.png"><br><img src="86DFFE0BE2BDE94ACDEE9957B1377E07.png" alt="Screen Shot 2018-10-12 at 19.35.29.png"></p>
<h3 id="自定义可调用对象"><a href="#自定义可调用对象" class="headerlink" title="自定义可调用对象"></a>自定义可调用对象</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CallableTest</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,items)</span>:</span></span><br><span class="line">        self.items = list(items)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pick</span><span class="params">(self,n)</span>:</span></span><br><span class="line">        random.shuffle(self.items)</span><br><span class="line">        <span class="keyword">return</span> self.items[<span class="number">0</span>:n]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self,n)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.pick(n)</span><br><span class="line"></span><br><span class="line">test = CallableTest([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line">print(test(<span class="number">2</span>))        <span class="comment"># -&gt; [1,3]</span></span><br></pre></td></tr></table></figure>
<h2 id="函数内省"><a href="#函数内省" class="headerlink" title="函数内省"></a>函数内省</h2><h3 id="函数有而自定义对象没有的属性"><a href="#函数有而自定义对象没有的属性" class="headerlink" title="函数有而自定义对象没有的属性"></a>函数有而自定义对象没有的属性</h3><p>[‘<strong>annotations</strong>‘, ‘<strong>call</strong>‘, ‘<strong>closure</strong>‘, ‘<strong>code</strong>‘, ‘<strong>defaults</strong>‘, ‘<strong>get</strong>‘, ‘<strong>globals</strong>‘, ‘<strong>kwdefaults</strong>‘, ‘<strong>name</strong>‘, ‘<strong>qualname</strong>‘]</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">obj = C()    </span><br><span class="line"></span><br><span class="line">print(sorted(set(dir(fact)) - set(dir(obj))))</span><br></pre></td></tr></table></figure>
<p><img src="0372A461E78029DED0A7D7121A49EAF1.png" alt="Screen Shot 2018-10-12 at 19.54.16.png"><br><img src="44DAA05E00DF81F67E96530C9FD4F62D.png" alt="Screen Shot 2018-10-12 at 19.54.25 1.png"></p>
<h2 id="参数传递"><a href="#参数传递" class="headerlink" title="参数传递"></a>参数传递</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parameters</span><span class="params">(name,*content, cls = <span class="string">"first_name"</span>, **attr)</span>:</span></span><br><span class="line">    print(name)  <span class="comment"># -&gt; 1</span></span><br><span class="line">    print(content) <span class="comment"># -&gt; (2, 3, 4)</span></span><br><span class="line">    print(cls) <span class="comment"># -&gt; zhang</span></span><br><span class="line">    print(attr) <span class="comment"># -&gt; &#123;'face': 'handsome', 'built': 'awesome'&#125;</span></span><br><span class="line"></span><br><span class="line">parameters(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,cls = <span class="string">"zhang"</span>, face = <span class="string">"handsome"</span>,built = <span class="string">"awesome"</span>)  </span><br><span class="line">print(parameters.__defaults__) <span class="comment"># -&gt; None</span></span><br><span class="line">print(parameters.__kwdefaults__) <span class="comment"># -&gt; &#123;'cls': 'first_name'&#125;</span></span><br><span class="line">print(parameters.__annotations__) <span class="comment"># -&gt; &#123;'return': 'test parameters'&#125;</span></span><br><span class="line">print(parameters.__doc__) <span class="comment"># -&gt; just for testing parameters</span></span><br></pre></td></tr></table></figure>
<h2 id="函数式编程"><a href="#函数式编程" class="headerlink" title="函数式编程"></a>函数式编程</h2><ul>
<li><p>operator 模块 和 functools 模块</p>
<ul>
<li>reduce</li>
<li>itemgetter 从序列或者对象中读取元素或者属性</li>
<li><p>methodcaller 自行函数，然后再调用对象上使用参数指定的方法(可以冻结参数)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> methodcaller</span><br><span class="line">split_and_replace = methodcaller(<span class="string">'replace'</span>,<span class="string">' '</span>,<span class="string">'_'</span>)</span><br><span class="line">name = <span class="string">"ZHAN RUO CHI"</span></span><br><span class="line">print(split_and_replace(name))  <span class="comment"># -&gt; ZHAN_RUO_CHI</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>partial  创建一个新的可调用对象，冻结原有对象的某些参数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> mul</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> partial</span><br><span class="line">triple = partial(mul,<span class="number">3</span>)</span><br><span class="line">print(triple(<span class="number">7</span>))  <span class="comment">#-&gt; 21</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h1 id="数据模型"><a href="#数据模型" class="headerlink" title="数据模型"></a>数据模型</h1><p>python 解释器在碰到特殊的句法时，会使用特殊方法去激活一些基本的对象操作。例如 len(x) 在调用时，如果 x 是内置对象，速度回非常快，因为 CPthon 会直接从一个 C 结构体里读取对象的长度。如果 x 不是内置对象，len(x) 会读取对象内部的<strong>len</strong>方法。这种处理方法在保持内置类型的效率和语言一致性之间找到平衡点。</p>
<blockquote>
<p>不能让特例特殊到开始破快既定规则   —zon of python</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> collections</span><br><span class="line">Card = collections.namedtuple(<span class="string">"Card"</span>,[<span class="string">"rank"</span>,<span class="string">"suit"</span>])</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FrenchDeck</span>:</span></span><br><span class="line">    ranks = [str(n) <span class="keyword">for</span> n <span class="keyword">in</span> range(<span class="number">2</span>,<span class="number">11</span>)] + list(<span class="string">"JQKA"</span>)</span><br><span class="line">    suits = <span class="string">"spades diamonds clubs hearts"</span>.split()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.__cards = [Card(rank,suit) <span class="keyword">for</span> suit <span class="keyword">in</span> FrenchDeck.suits <span class="keyword">for</span> rank <span class="keyword">in</span> FrenchDeck.ranks]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> len(self.__cards)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self,index)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__cards[index]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    deck = FrenchDeck()    </span><br><span class="line">    <span class="comment"># 可以使用 len() 函数查看一共多少张纸牌</span></span><br><span class="line">    print(len(deck))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 可以使用索引和切片</span></span><br><span class="line">    print(deck[<span class="number">-1</span>])</span><br><span class="line">    print(deck[<span class="number">1</span>:<span class="number">3</span>])</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 可以随机抽取纸牌</span></span><br><span class="line">    <span class="keyword">from</span> random <span class="keyword">import</span> choice</span><br><span class="line">    print(choice(deck))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 支持迭代</span></span><br><span class="line">    <span class="keyword">for</span> card <span class="keyword">in</span> deck:</span><br><span class="line">        print(card)</span><br></pre></td></tr></table></figure>
<p>两个好处</p>
<ul>
<li>类的用户不用再去记标准操作的名称</li>
<li>更加方便的利用 python 标准库</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> hypot</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vector</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,x,y)</span>:</span></span><br><span class="line">        self.x = x</span><br><span class="line">        self.y = y</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'Vector(&#123;&#125;,&#123;&#125;)'</span>.format(self.x,self.y)    </span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__abs__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> hypot(self.x,self.y)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__bool__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> bool(abs(self))</span><br><span class="line">        <span class="comment">#return bool(self.x or self.y)</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__add__</span><span class="params">(self,other)</span>:</span></span><br><span class="line">        x = self.x + other.x</span><br><span class="line">        y = self.y + other.y</span><br><span class="line">        <span class="keyword">return</span> Vector(x,y)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__mul__</span><span class="params">(self,scalar)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> Vector(self.x*scalar, self.y*scalar)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    print(Vector(<span class="number">3</span>,<span class="number">4</span>))</span><br><span class="line">    print(abs(Vector(<span class="number">3</span>,<span class="number">4</span>)))</span><br></pre></td></tr></table></figure>
<ul>
<li>_<em>reper_<em> 反对对象的字符串表示，_<em>str_<em>只有在调用 str()或者print()时才会调用，_<em>repr_</em> 是更好的选择，因为如果一个对象没有__str\</em></em>函数，python 又需要调用它时，解释器会调用 __repr\</em></em> 作为替代.</li>
</ul>
<ul>
<li>任何对象都可以用于需要布尔值的上下文中，为了判定一个值 x 的真假，Python 会调用bool(x), 其背后是调用 x._<em>bool_<em>()的结果;如果不存在该方法，那么 bool(x)会尝试调用 x.__len\</em></em>()。 若返回0，则 bool 会返回 False，否则返回 True。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>([])   <span class="comment">#False</span></span><br><span class="line"><span class="keyword">if</span>(<span class="number">0</span>)    <span class="comment">#false</span></span><br></pre></td></tr></table></figure>
<h1 id="文本和字节序列"><a href="#文本和字节序列" class="headerlink" title="文本和字节序列"></a>文本和字节序列</h1><h2 id="字符的问题"><a href="#字符的问题" class="headerlink" title="字符的问题"></a>字符的问题</h2><p>Python3中，str 对象中获取的元素是 unicode 字符<br>unicode 标准把字符做了如下区分</p>
<ul>
<li>字符的标识，在 unicode 标准中以4~6个十六进制的数字，然后加前缀 U+. 如A的码位是U+0041</li>
<li>字符的具体表述取决于所用的编码.</li>
<li>编码是在码位与字节序列之间的转换. 如 A 在 UTF8中编码成单个字节\x41</li>
</ul>
<h2 id="二进制序列类型"><a href="#二进制序列类型" class="headerlink" title="二进制序列类型"></a>二进制序列类型</h2><p>分为不可变 bytes 类型和 bytearray 类型</p>
<ul>
<li><p>bytes对象可以从str 对象使用给定的编码构建</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cafe = bytes(<span class="string">'cafe'</span>,encoding=<span class="string">"utf8"</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>字节序列的切片还是字节序列</p>
<ul>
<li>my_bytes[0] 是整数</li>
<li>my_bytes[:1] 是字节序列</li>
</ul>
</li>
<li>二进制序列其实是整数序列，但是它们各个字节的值可能会用如下三种表示法<ul>
<li>可打印 ASCII 范围内的字节使用ASCII字符本身</li>
<li>制表符,换行符,回车符和\使用转义序列\t….</li>
<li>其他字节的值，使用使用十六进制转义序列<br>如 b’caf\xc3\xa9’ 前三个字节b’caf’在可打印的 ASCII 范围内，后两个字节则不然.</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> array</span><br><span class="line">numbers = array.array(<span class="string">'h'</span>,[<span class="number">-2</span>,<span class="number">-1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>])</span><br><span class="line">octets = bytes(numbers)</span><br><span class="line">print(octets)</span><br></pre></td></tr></table></figure>
<h2 id="编码中遇到的问题"><a href="#编码中遇到的问题" class="headerlink" title="编码中遇到的问题"></a>编码中遇到的问题</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">my_str = <span class="string">"Português"</span></span><br><span class="line">print(my_str.encode(<span class="string">"utf8"</span>))</span><br><span class="line"><span class="comment"># print(my_str.encode("ascii"))  #-&gt; 报错</span></span><br><span class="line">print(my_str.encode(<span class="string">"ascii"</span>,errors=<span class="string">'ignore'</span>))  <span class="comment">#-&gt; b'Portugus'</span></span><br><span class="line">print(my_str.encode(<span class="string">"ascii"</span>,errors=<span class="string">'replace'</span>)) <span class="comment">#-&gt; b'Portugu?s'</span></span><br></pre></td></tr></table></figure>
<h2 id="处理文本文件"><a href="#处理文本文件" class="headerlink" title="处理文本文件"></a>处理文本文件</h2><h3 id="最佳方式，unicode-三明治"><a href="#最佳方式，unicode-三明治" class="headerlink" title="最佳方式，unicode 三明治"></a>最佳方式，unicode 三明治</h3><ul>
<li>尽早把输入(比如读取文件时)的字节序列转化为字符串</li>
<li>只操作字符串</li>
<li>尽量晚地把字符串转化为字节序列<br><img src="F078127CF59F53B4C8F7F39C6BF45A1C.png" alt="Screen Shot 2018-09-30 at 11.32.45.png"></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">my_str = <span class="string">"Português"</span></span><br><span class="line">open(<span class="string">"cafe.txt"</span>,<span class="string">'w'</span>,encoding=<span class="string">'utf8'</span>).write(my_str)</span><br><span class="line">print(open(<span class="string">"cafe.txt"</span>).read())  <span class="comment">#-&gt;报错</span></span><br><span class="line">print(open(<span class="string">"cafe.txt"</span>,encoding = <span class="string">"utf8"</span>).read()) <span class="comment">#-&gt; 正确</span></span><br><span class="line">print(open(<span class="string">"cafe.txt"</span>,<span class="string">'rb'</span>).read()) <span class="comment">#-&gt; b'Portugu\xc3\xaas', 以二进制方式读取文件，没有问题</span></span><br></pre></td></tr></table></figure>
<h2 id="为了正确比较而规范化字符串"><a href="#为了正确比较而规范化字符串" class="headerlink" title="为了正确比较而规范化字符串"></a>为了正确比较而规范化字符串</h2><p>unicode有组合字符(变音符号和附加到前一个字符上的记号，打印时作为一个整体),所以字符串比较起来很复杂。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#已解决该问题？</span></span><br><span class="line">my_str1 = <span class="string">"Portugués"</span></span><br><span class="line">my_str2 = <span class="string">"Portugue\u0301s"</span></span><br><span class="line">print(my_str1)</span><br><span class="line">print(my_str2)</span><br><span class="line">print(my_str1 == my_str2)  <span class="comment">#-&gt; True</span></span><br><span class="line">print(len(my_str1) == len(my_str2)) <span class="comment">#-&gt; True</span></span><br></pre></td></tr></table></figure></p>
<p>去掉所有重音符号</p>
<ul>
<li>NFD 拆解组合字符为基字符和单独的组合字符</li>
<li>NFC 使用最小的码位构成组合字符串<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from unicodedata import normalize</span><br><span class="line">from unicodedata import combining</span><br><span class="line">my_str = &quot;Portugués&quot;</span><br><span class="line">new_str =  &quot;&quot;.join(c for c in normalize(&quot;NFD&quot;,my_str) if not combining(c))</span><br><span class="line">print(new_str)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="生成器与迭代器"><a href="#生成器与迭代器" class="headerlink" title="生成器与迭代器"></a>生成器与迭代器</h1><h2 id="可迭代的原因"><a href="#可迭代的原因" class="headerlink" title="可迭代的原因"></a>可迭代的原因</h2><ul>
<li>实现了_<em>iter_</em>函数</li>
<li>内置的 iter 函数有以下作用<ul>
<li>检查对象是否实现_<em>iter_</em>函数，如果实现，返回迭代器</li>
<li>没有实现可迭代对象，如果现实_<em>getitem_</em>方法，python 返回一个迭代器，尝试从索引0开始迭代</li>
<li>尝试失败，跑出 TypeError 异常<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">"zhangruochi"</span></span><br><span class="line"><span class="keyword">for</span> chr <span class="keyword">in</span> s:</span><br><span class="line">    print(chr)</span><br><span class="line">    </span><br><span class="line">print(<span class="string">"-------"</span>)</span><br><span class="line"></span><br><span class="line">it = iter(s)</span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        print(next(it))</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">del</span> it</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h2 id="迭代器与可迭代对象之间的关系"><a href="#迭代器与可迭代对象之间的关系" class="headerlink" title="迭代器与可迭代对象之间的关系"></a>迭代器与可迭代对象之间的关系</h2><ul>
<li>可迭代对象实现_<em>iter_</em>方法，返回一个迭代器实例</li>
<li>迭代器实现_<em>iter_</em> 方法，返回自己，为了通过 issubclass(iterator,abc.Iterator) 测试</li>
<li>迭代器还要实现_<em>next_</em>方法，每次返回一个元素</li>
<li>可迭代对象一定不能是自身的迭代器，也就是不能包含_<em>next_</em> 方法<br><img src="8FE3ACE51E02FD7F405BE86E1B8346EE.png" alt="Screen Shot 2018-10-15 at 22.47.57.png"><br><img src="DA4E95C453BEEAF371768C77B884032F.png" alt="Screen Shot 2018-10-15 at 22.48.05.png"></li>
</ul>
<h2 id="生成器函数"><a href="#生成器函数" class="headerlink" title="生成器函数"></a>生成器函数</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">RE_WORD = re.compile(<span class="string">"\w+"</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sentence</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, text)</span>:</span></span><br><span class="line">        self.text = text</span><br><span class="line">        self.words = RE_WORD.findall(text)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> word <span class="keyword">in</span> self.words:</span><br><span class="line">            <span class="keyword">yield</span> word</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s = <span class="string">"zhang ruo chi"</span></span><br><span class="line"></span><br><span class="line">sentence = Sentence(s)</span><br><span class="line"><span class="keyword">for</span> word <span class="keyword">in</span> sentence:</span><br><span class="line">    print(word)</span><br></pre></td></tr></table></figure>
<ul>
<li>生成器对象也是迭代器，利用iter方法返回一个生成器对象，可以不用再单独定义迭代器</li>
<li>包含yield关键词的函数是生成器函数，调用生成器函数时，会返回一个生成器对象，也就是说，生成器函数是生成器工厂</li>
<li>把生成器传递给 next()函数时，生成器会向前运行，遇到 yield 关键词会停止并返回产出的值</li>
</ul>
<h1 id="静态类和静态方法"><a href="#静态类和静态方法" class="headerlink" title="静态类和静态方法"></a>静态类和静态方法</h1><h2 id="example"><a href="#example" class="headerlink" title="example"></a>example</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Date</span><span class="params">(object)</span>:</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, day=<span class="number">0</span>, month=<span class="number">0</span>, year=<span class="number">0</span>)</span>:</span></span><br><span class="line">        self.day = day</span><br><span class="line">        self.month = month</span><br><span class="line">        self.year = year</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">from_string</span><span class="params">(cls, date_as_string)</span>:</span></span><br><span class="line">        day, month, year = map(int, date_as_string.split(<span class="string">'-'</span>))</span><br><span class="line">        date1 = cls(day, month, year)</span><br><span class="line">        <span class="keyword">return</span> date1 </span><br><span class="line">    </span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_date_valid</span><span class="params">(date_as_string)</span>:</span></span><br><span class="line">        day, month, year = map(int, date_as_string.split(<span class="string">'-'</span>))</span><br><span class="line">        <span class="keyword">return</span> day &lt;= <span class="number">31</span> <span class="keyword">and</span> month &lt;= <span class="number">12</span> <span class="keyword">and</span> year &lt;= <span class="number">3999</span>  </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'main'</span>:</span><br><span class="line">    date2 = Date.from_string(<span class="string">'11-09-2012'</span>)</span><br><span class="line">    is_date = Date.is_date_valid(<span class="string">'11-09-2012'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="class-method"><a href="#class-method" class="headerlink" title="class method"></a>class method</h3><p>我们在一个方法中实现了功能，因此它是可重用的。 这里的封装处理的不错（如果你发现还可以在代码的任意地方添加一个不属于 Date 的函数来实现类似的功能，那很显然上面的办法更符合 OOP 规范）。 cls 是一个保存了 class 的对象（所有的一切都是对象）。 更妙的是， Date 类的衍生类都会具有 from_string 这个有用的方法。</p>
<h3 id="static-method"><a href="#static-method" class="headerlink" title="static method"></a>static method</h3><p>从静态方法的使用中可以看出，我们不会访问到 class 本身 – 它基本上只是一个函数，在语法上就像一个方法一样，但是没有访问对象和它的内部（字段和其他方法），相反 classmethod 会访问 cls， instancemethod 会访问 self。</p>

      
    </div>
    
    
    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Python/" rel="tag"># Python</a>
          
            <a href="/tags/Book-Note/" rel="tag"># Book Note</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/Bigtable-A-Distributed-Storage-System-for-Structured-Data/2019/02/28/" rel="next" title="Bigtable: A Distributed Storage System for Structured Data">
                <i class="fa fa-chevron-left"></i> Bigtable: A Distributed Storage System for Structured Data
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/Matrix-Algebra-for-Engineers-part-one/2019/03/17/" rel="prev" title="Matrix Algebra for Engineers (part one)">
                Matrix Algebra for Engineers (part one) <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>Donate article here</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>Donate</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.png" alt="Ruochi Zhang WeChat Pay">
        <p>WeChat Pay</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="Ruochi Zhang Alipay">
        <p>Alipay</p>
      </div>
    

    

  </div>
</div>

      </div>
    


  </div>
  
  
  
  </article>



    <div class="post-spread">
      
        <!--MOB SHARE BEGIN-->
<div class="-hoofoo-share-title">Share the post</div>
<div class="-hoofoo-share-buttons">
    <div class="-mob-share-weibo -hoofoo-share-weibo -hoofoo-share-ui-button"><i class="fa fa-weibo" aria-hidden="true"></i></div>
    <div class="-mob-share-weixin -hoofoo-share-weixin -hoofoo-share-ui-button"><i class="fa fa-weixin" aria-hidden="true"></i></div>
    <div class="-mob-share-twitter -hoofoo-share-twitter -hoofoo-share-ui-button"><i class="fa fa-twitter" aria-hidden="true"></i></div>
    <div class="-hoofoo-share-more -hoofoo-share-ui-button -mob-share-open"><i class="fa fa-ellipsis-h" aria-hidden="true"></i></div>
</div>
<div class="-mob-share-ui" style="display: none">
    <ul class="-mob-share-list">
        <li class="-mob-share-weibo"><p>新浪微博</p></li>
        <li class="-mob-share-weixin"><p>微信</p></li>
        <li class="-mob-share-qzone"><p>QQ空间</p></li>
        <li class="-mob-share-qq"><p>QQ好友</p></li>
        <li class="-mob-share-douban"><p>豆瓣</p></li>
        <li class="-mob-share-facebook"><p>Facebook</p></li>
        <li class="-mob-share-twitter"><p>Twitter</p></li>
        <li class="-mob-share-instapaper"><p>Instapaper</p></li>
        <li class="-mob-share-linkedin"><p>Linkedin</p></li>
    </ul>
    <div class="-mob-share-close">Cancel</div>
</div>
<div class="-mob-share-ui-bg"></div>
<script id="-mob-share" src="https://f1.webshare.mob.com/code/mob-share.js?appkey=2a11bcb245035"></script>
<!--MOB SHARE END-->
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC80MjYwOC8xOTE1NQ=="></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.png" alt="Ruochi Zhang">
            
              <p class="site-author-name" itemprop="name">Ruochi Zhang</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">70</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">17</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">15</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/zhangruochi" target="_blank" title="GitHub rel=" external="" nofollow""="">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:zrc720@gmail.com" target="_blank" title="E-Mail rel=" external="" nofollow""="">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Friend links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.healthinformaticslab.org" title="HILab" target="_blank" rel="external nofollow">HILab</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.shihaizhou.com" title="Rose" target="_blank" rel="external nofollow">Rose</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.cnblogs.com/cecilia-xu/" title="Xiaoqiang Xu" target="_blank" rel="external nofollow">Xiaoqiang Xu</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#字典"><span class="nav-text">字典</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#泛映射类型"><span class="nav-text">泛映射类型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#什么是可散列数据？"><span class="nav-text">什么是可散列数据？</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#字典推导"><span class="nav-text">字典推导</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#常用的映射方法"><span class="nav-text">常用的映射方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#setdefault-用法"><span class="nav-text">setdefault 用法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#映射的弹性查询"><span class="nav-text">映射的弹性查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#defaultdict"><span class="nav-text">defaultdict</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自己创建继承-dict-类型，然后充血-miss-方法"><span class="nav-text">自己创建继承 dict 类型，然后充血_miss_方法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#字典的变种"><span class="nav-text">字典的变种</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#子类化-UserDict"><span class="nav-text">子类化 UserDict</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#不可变的映射类型"><span class="nav-text">不可变的映射类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#集合论"><span class="nav-text">集合论</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#集合的运算"><span class="nav-text">集合的运算</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#集合的比较运算"><span class="nav-text">集合的比较运算</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#dict-set-list效率比较"><span class="nav-text">dict set list效率比较</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#散列表原理"><span class="nav-text">散列表原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#dict-conclusion"><span class="nav-text">dict conclusion</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#set-conclusion"><span class="nav-text">set conclusion</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#序列模型"><span class="nav-text">序列模型</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#分类"><span class="nav-text">分类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#列表推倒与生成器"><span class="nav-text">列表推倒与生成器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#列表推倒"><span class="nav-text">列表推倒</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#生成器表达式"><span class="nav-text">生成器表达式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#元组"><span class="nav-text">元组</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#元组与记录"><span class="nav-text">元组与记录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#元组拆包"><span class="nav-text">元组拆包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#嵌套拆包"><span class="nav-text">嵌套拆包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#具名元组"><span class="nav-text">具名元组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#作为不可变列表的元组"><span class="nav-text">作为不可变列表的元组</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#切片"><span class="nav-text">切片</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#对象切片"><span class="nav-text">对象切片</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#多维切片"><span class="nav-text">多维切片</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#切片赋值"><span class="nav-text">切片赋值</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#对序列对象使用-和"><span class="nav-text">对序列对象使用+和*</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#序列的增量赋值"><span class="nav-text">序列的增量赋值</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#序列对象的排序"><span class="nav-text">序列对象的排序</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#就地排序和负值排序"><span class="nav-text">就地排序和负值排序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参数"><span class="nav-text">参数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#利用bisect-管理已排序的序列"><span class="nav-text">利用bisect 管理已排序的序列</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#list的可替换对象"><span class="nav-text">list的可替换对象</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#array-array"><span class="nav-text">array.array</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#内存视图"><span class="nav-text">内存视图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#memoryview-cast-可以利用不同的方式读写同一块内存"><span class="nav-text">memoryview.cast 可以利用不同的方式读写同一块内存</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#双向队列和其他形式的队列"><span class="nav-text">双向队列和其他形式的队列</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#collections-deque"><span class="nav-text">collections.deque</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#queue"><span class="nav-text">queue</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#heapq"><span class="nav-text">heapq</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#函数"><span class="nav-text">函数</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#一等对象"><span class="nav-text">一等对象</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#高阶函数"><span class="nav-text">高阶函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#map-filter-reduce-极其替代品"><span class="nav-text">map,filter,reduce 极其替代品</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#lambda-表达式"><span class="nav-text">lambda 表达式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#七种可调用对象"><span class="nav-text">七种可调用对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自定义可调用对象"><span class="nav-text">自定义可调用对象</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#函数内省"><span class="nav-text">函数内省</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#函数有而自定义对象没有的属性"><span class="nav-text">函数有而自定义对象没有的属性</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参数传递"><span class="nav-text">参数传递</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#函数式编程"><span class="nav-text">函数式编程</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#数据模型"><span class="nav-text">数据模型</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#文本和字节序列"><span class="nav-text">文本和字节序列</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#字符的问题"><span class="nav-text">字符的问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二进制序列类型"><span class="nav-text">二进制序列类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#编码中遇到的问题"><span class="nav-text">编码中遇到的问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#处理文本文件"><span class="nav-text">处理文本文件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#最佳方式，unicode-三明治"><span class="nav-text">最佳方式，unicode 三明治</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#为了正确比较而规范化字符串"><span class="nav-text">为了正确比较而规范化字符串</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#生成器与迭代器"><span class="nav-text">生成器与迭代器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#可迭代的原因"><span class="nav-text">可迭代的原因</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#迭代器与可迭代对象之间的关系"><span class="nav-text">迭代器与可迭代对象之间的关系</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#生成器函数"><span class="nav-text">生成器函数</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#静态类和静态方法"><span class="nav-text">静态类和静态方法</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#example"><span class="nav-text">example</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#class-method"><span class="nav-text">class method</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#static-method"><span class="nav-text">static method</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ruochi Zhang</span>
  
  
</div>








        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  
    <script type="text/javascript">
   (function(d, s) {
       var j, e = d.getElementsByTagName(s)[0];

       if (typeof LivereTower === 'function') { return; }

       j = d.createElement(s);
       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
       j.async = true;

       e.parentNode.insertBefore(j, e);
   })(document, 'script');
</script>
<noscript>Please activate JavaScript for write a comment in LiveRe</noscript>
  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->


  
  

  
  


  

  

  
</body>
</html>
